<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>همسر پرفیوم - فروشگاه تخصصی عطرهای لاکچری</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #0f3460;
            --accent: #e94560;
            --accent-light: #ff7b93;
            --light: #f0f5f9;
            --dark: #16213e;
            --text: #333;
            --white: #ffffff;
            --gray: #f8f9fa;
            --gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --transition: all 0.3s ease;
            --shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --glass: rgba(255, 255, 255, 0.15);
            --glass-dark: rgba(26, 26, 46, 0.8);
            --blur: blur(10px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background-color: var(--light);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            font-weight: 400;
        }
        
        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--blur);
            box-shadow: var(--shadow);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            color: var(--primary);
            text-decoration: none;
            font-size: 24px;
            font-weight: 700;
            gap: 10px;
        }
        
        .logo-text {
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -0.5px;
        }
        
        .logo-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
            transition: transform 0.3s ease;
        }
        
        .nav-desktop {
            display: flex;
            gap: 25px;
        }
        
        .nav-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            position: relative;
            padding: 8px 0;
            font-size: 16px;
        }
        
        .nav-link:hover {
            color: var(--accent);
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .header-icons {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }
        
        .icon-btn:hover {
            color: var(--accent);
            transform: translateY(-2px);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--accent-light);
            transition: var(--transition);
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
        }
        
        .badge {
            position: absolute;
            top: -8px;
            left: -10px;
            background: var(--accent);
            color: var(--white);
            font-size: 12px;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .hamburger span {
            height: 3px;
            width: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: var(--transition);
        }
        
        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }
        
        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--blur);
            z-index: 1000;
            transition: var(--transition);
            padding: 80px 20px 20px;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .mobile-menu.active {
            right: 0;
        }
        
        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .mobile-nav-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 18px;
            padding: 12px 20px;
            border-radius: 8px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(248, 249, 250, 0.5);
            backdrop-filter: var(--blur);
        }
        
        .mobile-nav-link:hover {
            background: rgba(233, 69, 96, 0.1);
            padding-right: 25px;
        }
        
        .mobile-nav-link i {
            font-size: 20px;
            min-width: 25px;
            color: var(--accent);
        }
        
        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .auth-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--blur);
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-auth-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            z-index: 10;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .auth-tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #777;
            transition: var(--transition);
            position: relative;
        }
        
        .auth-tab.active {
            color: var(--accent);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: 0;
            width: 100%;
            height: 3px;
            background: var(--accent);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form-group {
            margin-bottom: 20px;
        }
        
        .auth-form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .auth-form-input {
            width: 100%;
            padding: 14px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }
        
        .auth-form-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.2);
        }
        
        .auth-form-button {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        
        .auth-form-button:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }
        
        .auth-social-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .auth-social-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #ddd;
            background: white;
            color: #333;
        }
        
        .auth-social-button.google {
            color: #DB4437;
            border-color: #DB4437;
        }
        
        /* User Dropdown */
        .user-dropdown {
            position: relative;
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: 50px;
            left: 0;
            background: white;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }
        
        .user-dropdown:hover .user-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .user-dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .user-dropdown-item:hover {
            background: #f8f9fa;
            color: var(--accent);
        }
        
        .user-dropdown-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Hero Section */
        .hero {
            height: 500px;
            background: linear-gradient(rgba(22, 33, 62, 0.85), rgba(22, 33, 62, 0.9)), 
                        url('https://images.unsplash.com/photo-1595425977377-6aaf06c4457c?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 20px;
            position: relative;
            overflow: hidden;
            margin-bottom: 50px;
        }
        
        .hero-content {
            max-width: 800px;
            position: relative;
            z-index: 1;
        }
        
        .hero-title {
            font-size: 3rem;
            color: var(--white);
            margin-bottom: 20px;
            font-weight: 900;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: var(--accent-light);
            margin-bottom: 40px;
            font-weight: 500;
            text-shadow: 0 1px 5px rgba(0,0,0,0.3);
        }
        
        /* Products Section */
        .section {
            padding: 60px 20px;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            color: var(--dark);
            font-weight: 900;
            display: inline-block;
            padding-bottom: 15px;
            position: relative;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--accent);
            border-radius: 2px;
        }
        
        .products-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transition: var(--transition);
            position: relative;
            border: 1px solid rgba(240, 240, 240, 0.7);
            transform: translateY(0);
            display: flex;
            flex-direction: column;
        }
        
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .product-image {
            height: 240px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            aspect-ratio: 1/1;
        }
        
        .product-image img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            transition: var(--transition);
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.05);
        }
        
        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--accent);
            color: var(--white);
            padding: 6px 15px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 700;
            z-index: 3;
        }
        
        .product-info {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .product-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .product-title:hover {
            color: var(--accent);
        }
        
        .product-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .product-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }
        
        .action-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }
        
        /* Cart Modal */
        .cart-modal {
            position: fixed;
            top: 0;
            right: -420px;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--blur);
            z-index: 2500; /* Increased Z-index */
            transition: right 0.4s ease;
            box-shadow: -5px 0 25px rgba(0,0,0,0.15);
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .cart-modal.open {
            right: 0;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .cart-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--dark);
        }
        
        .close-cart {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #777;
            transition: var(--transition);
        }
        
        .close-cart:hover {
            transform: rotate(90deg);
        }
        
        .cart-items {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 25px;
        }
        
        .cart-item {
            display: flex;
            gap: 18px;
            padding: 18px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .cart-item-image {
            width: 90px;
            height: 90px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cart-item-image img {
            max-width: 75%;
            max-height: 75%;
        }
        
        .cart-item-details {
            flex: 1;
        }
        
        .cart-item-name {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .cart-item-size {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }
        
        .cart-item-price {
            font-weight: 700;
            color: var(--accent);
            font-size: 17px;
        }
        
        .cart-item-remove {
            color: #ff6b6b;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            align-self: flex-start;
            transition: var(--transition);
        }
        
        .cart-item-remove:hover {
            transform: scale(1.1);
        }
        
        .cart-summary {
            padding: 25px;
            border-top: 1px solid #ddd;
            background: rgba(255,255,255,0.7);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .generate-order {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 17px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        
        .generate-order:hover {
            background: var(--accent-light);
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(233, 69, 96, 0.5);
        }
        
        /* Footer Styles */
        .footer {
            background: var(--gradient);
            color: var(--white);
            padding: 70px 0 30px;
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }
        
        .footer-section h3 {
            font-size: 22px;
            margin-bottom: 25px;
            color: var(--accent-light);
            position: relative;
            padding-bottom: 12px;
            font-weight: 800;
        }
        
        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--accent);
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-section ul li a:hover {
            color: var(--accent-light);
        }
        
        .social-links {
            display: flex;
            gap: 18px;
            margin-top: 25px;
        }
        
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            border-radius: 50%;
            transition: var(--transition);
            font-size: 18px;
        }
        
        .social-links a:hover {
            background: var(--accent);
            transform: translateY(-5px);
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 15px;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: var(--blur);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Product Detail Modal */
        .product-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .product-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .product-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--blur);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 15px;
            overflow: hidden;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        
        .close-product-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .close-product-modal:hover {
            transform: rotate(90deg);
        }
        
        .product-detail-container {
            display: flex;
            flex-direction: column;
        }
        
        .product-detail-image {
            flex: 1;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            padding: 30px;
        }
        
        .product-detail-info {
            flex: 1;
            padding: 30px;
        }
        
        .product-detail-title {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: 900;
        }
        
        .product-detail-price {
            font-size: 24px;
            color: var(--accent);
            font-weight: 800;
            margin-bottom: 20px;
        }
        
        .product-detail-sizes h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }
        
        .size-option-detail {
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--white);
            text-align: center;
        }
        
        .size-option-detail.active {
            border-color: var(--accent);
            background: var(--accent);
            color: var(--white);
        }
        
        .product-detail-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .add-to-cart-detail {
            flex: 1;
            background: var(--accent);
            color: var(--white);
            border: none;
            padding: 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .wishlist-btn-detail {
            width: 50px;
            height: 50px;
            background: var(--white);
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }
        
        .wishlist-btn-detail.active {
            color: var(--accent);
            border-color: var(--accent);
            background: #fff0f3;
        }
        
        /* Overlay for modals */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1500; /* Below modals */
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* Size Selection Modal */
        .size-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .size-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .size-modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--blur);
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            padding: 25px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
        }
        
        .close-size-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            z-index: 10;
        }
        
        .add-to-cart-size {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: var(--white);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 15px;
        }
        
        /* Search Bar */
        .search-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: var(--blur);
            padding: 15px 20px;
            z-index: 1100;
            transform: translateY(-100%);
            transition: transform 0.4s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .search-header.active {
            transform: translateY(0);
        }
        
        .search-header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .close-search {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
        }
        
        .search-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        /* Checkout Steps */
        .checkout-modal-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .checkout-steps {
            flex-shrink: 0;
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin-bottom: 30px;
            position: relative;
        }

        .checkout-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 15%;
            right: 15%;
            height: 2px;
            background: #ddd;
            z-index: 0;
        }
        .checkout-progress {
            position: absolute;
            top: 20px;
            right: 15%;
            height: 2px;
            background: var(--accent);
            z-index: 1;
            transition: width 0.4s ease;
            width: 0;
        }
        .checkout-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            width: 30%;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            color: #777;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .step-title {
            font-size: 14px;
            color: #777;
            text-align: center;
            transition: all 0.3s;
        }

        .checkout-step.active .step-number {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }
        .checkout-step.active .step-title {
            color: var(--accent);
            font-weight: 600;
        }

        .checkout-step.completed .step-number {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }
        
        /* Checkout Forms */
        .checkout-form-container {
            display: none;
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 15px;
            /* Mobile Responsiveness: Add padding for safe area */
            padding-bottom: calc(100px + env(safe-area-inset-bottom));
        }

        .checkout-form-container.active {
            display: block;
        }

        .checkout-form {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label .label-note {
            font-size: 12px;
            font-weight: 400;
            color: #777;
            margin-right: 5px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.2);
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-col {
            flex: 1;
        }

        .checkout-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            /* Mobile Responsiveness: Sticky buttons */
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff;
            padding: 15px;
            border-top: 1px solid #eee;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }

        .btn {
            padding: 12px 25px;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }

        /* Order Confirmation */
        .order-confirmation {
            text-align: center;
            padding: 40px 20px;
        }

        .order-confirmation-icon {
            font-size: 60px;
            color: #4CAF50;
            margin-bottom: 20px;
        }
        
        /* Generic Modal for Profile/Orders/Admin */
        .generic-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .generic-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .generic-modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: var(--blur);
            width: 90%;
            max-width: 1000px; /* Increased for admin panel */
            max-height: 90vh;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        .close-generic-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--accent);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            z-index: 10;
        }
        .generic-modal-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 25px;
            color: var(--dark);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }
        
        /* Admin Panel Styles */
        .admin-table-container {
            width: 100%;
            overflow-x: auto;
        }
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            border: 1px solid #ddd;
            text-align: right;
        }
        .admin-table th {
            background-color: var(--secondary);
            color: white;
            font-weight: 600;
        }
        .admin-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .admin-table tr:hover {
            background-color: #f1f1f1;
        }
        .admin-table .status-select {
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .admin-table .update-status-btn {
            padding: 5px 10px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .admin-table .receipt-link {
            color: var(--accent);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .header-container {
                display: grid;
                grid-template-columns: auto 1fr auto;
                align-items: center;
                gap: 15px;
                padding: 0 20px;
            }
            .hamburger { display: flex; }
            .logo { justify-self: center; }
            .header-icons { justify-self: end; }
            .nav-desktop { display: none; }
            .hero-title { font-size: 2.2rem; }
            .form-row { flex-direction: column; }
        }
        
        @media (max-width: 768px) {
            .products-grid {
                grid-template-columns: repeat(2, minmax(160px, 1fr));
                gap: 15px;
            }
            .product-detail-container { flex-direction: column; }
        }
        
        @media (max-width: 576px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            .footer-content { grid-template-columns: 1fr; }
        }

    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <a href="#" class="logo">
                <div class="logo-text">همسر پرفیوم</div>
                <img src="https://placehold.co/100x100/E94560/FFFFFF?text=HP" alt="لوگو همسر پرفیوم" class="logo-image">
            </a>
            
            <div class="header-icons">
                <button class="icon-btn" id="searchIcon"><i class="fas fa-search"></i></button>
                <button class="icon-btn" id="wishlistIcon">
                    <i class="far fa-heart"></i>
                    <span class="badge" id="wishlistCount">0</span>
                </button>
                <button class="icon-btn" id="cartIcon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge" id="cartCount">0</span>
                </button>
                
                <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <img src="https://placehold.co/40x40" alt="پروفایل کاربر" class="user-avatar" id="userAvatar">
                    <div class="user-dropdown-menu">
                        <a href="#" class="user-dropdown-item" id="profileLink"><i class="fas fa-user"></i> پروفایل</a>
                        <a href="#" class="user-dropdown-item" id="ordersLink"><i class="fas fa-shopping-bag"></i> سفارشات</a>
                        <a href="#" class="user-dropdown-item" id="adminLink" style="display: none;"><i class="fas fa-user-shield"></i> پنل مدیریت</a>
                        <a href="#" class="user-dropdown-item" id="logoutLink"><i class="fas fa-sign-out-alt"></i> خروج</a>
                    </div>
                </div>
                
                <button class="icon-btn" id="loginBtn"><i class="fas fa-user"></i></button>
            </div>
            
            <nav class="nav-desktop">
                <a href="#" class="nav-link">خانه</a>
                <a href="#men" class="nav-link">عطر مردانه</a>
                <a href="#women" class="nav-link">عطر زنانه</a>
                <a href="#unisex" class="nav-link">یونی‌سکس</a>
                <a href="#contact" class="nav-link">تماس با ما</a>
            </nav>
        </div>
        
        <div class="mobile-menu" id="mobileMenu">
             <nav class="mobile-nav">
                <a href="#" class="mobile-nav-link close-mobile-menu"><i class="fas fa-home"></i> خانه</a>
                <a href="#men" class="mobile-nav-link close-mobile-menu"><i class="fas fa-male"></i> عطر مردانه</a>
                <a href="#women" class="mobile-nav-link close-mobile-menu"><i class="fas fa-female"></i> عطر زنانه</a>
                <a href="#unisex" class="mobile-nav-link close-mobile-menu"><i class="fas fa-venus-mars"></i> یونی‌سکس</a>
                <a href="#contact" class="mobile-nav-link close-mobile-menu"><i class="fas fa-phone"></i> تماس با ما</a>
                <a href="#" class="mobile-nav-link" id="mobileWishlist"><i class="far fa-heart"></i> لیست علاقه‌مندی‌ها</a>
                <a href="#" class="mobile-nav-link" id="mobileCart"><i class="fas fa-shopping-cart"></i> سبد خرید</a>
                <div id="mobileUserSection" style="display: none;">
                    <a href="#" class="mobile-nav-link" id="mobileProfile"><i class="fas fa-user"></i> پروفایل</a>
                    <a href="#" class="mobile-nav-link" id="mobileOrders"><i class="fas fa-shopping-bag"></i> سفارشات</a>
                    <a href="#" class="mobile-nav-link" id="mobileAdmin" style="display: none;"><i class="fas fa-user-shield"></i> پنل مدیریت</a>
                    <a href="#" class="mobile-nav-link" id="mobileLogout"><i class="fas fa-sign-out-alt"></i> خروج</a>
                </div>
                <a href="#" class="mobile-nav-link" id="mobileLogin" style="display: flex;"><i class="fas fa-sign-in-alt"></i> ورود / ثبت‌نام</a>
            </nav>
        </div>
    </header>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-content">
            <button class="close-auth-modal" id="closeAuthModal">&times;</button>
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">ورود</div>
                <div class="auth-tab" data-tab="register">ثبت‌نام</div>
            </div>
            <!-- Login Form -->
            <div class="auth-form active" id="loginForm">
                <div class="auth-form-group">
                    <label for="loginEmail" class="auth-form-label">ایمیل</label>
                    <input type="email" id="loginEmail" class="auth-form-input" placeholder="example@example.com">
                </div>
                <div class="auth-form-group">
                    <label for="loginPassword" class="auth-form-label">رمز عبور</label>
                    <input type="password" id="loginPassword" class="auth-form-input" placeholder="رمز عبور">
                </div>
                <button class="auth-form-button" id="loginButton">ورود به حساب</button>
                <div class="auth-social-buttons" style="margin-top: 15px;">
                    <button class="auth-social-button google" id="googleLogin"><i class="fab fa-google"></i> ورود با گوگل</button>
                </div>
            </div>
            <!-- Register Form -->
            <div class="auth-form" id="registerForm">
                <div class="auth-form-group">
                    <label for="registerName" class="auth-form-label">نام و نام خانوادگی</label>
                    <input type="text" id="registerName" class="auth-form-input" placeholder="نام و نام خانوادگی">
                </div>
                <div class="auth-form-group">
                    <label for="registerEmail" class="auth-form-label">ایمیل</label>
                    <input type="email" id="registerEmail" class="auth-form-input" placeholder="example@example.com">
                </div>
                <div class="auth-form-group">
                    <label for="registerPassword" class="auth-form-label">رمز عبور</label>
                    <input type="password" id="registerPassword" class="auth-form-input" placeholder="حداقل ۶ کاراکتر">
                </div>
                <button class="auth-form-button" id="registerButton">ثبت‌نام</button>
                 <div class="auth-social-buttons" style="margin-top: 15px;">
                    <button class="auth-social-button google" id="googleRegister"><i class="fab fa-google"></i> ثبت‌نام با گوگل</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Header -->
    <div class="search-header" id="searchHeader">
        <div class="search-header-container">
            <button class="close-search" id="closeSearch"><i class="fas fa-arrow-right"></i></button>
            <input type="text" class="search-input" id="searchInput" placeholder="جستجوی محصولات...">
        </div>
        <div class="search-results" id="searchResults" style="display: none; max-height: 400px; overflow-y: auto; margin-top: 15px; border-radius: 8px; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"></div>
    </div>
    
    <!-- Main Content -->
    <main>
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">کشف رایحه‌های منحصر به فرد</h1>
                <p class="hero-subtitle">با بهترین عطرهای اورجینال از همسر پرفیوم</p>
            </div>
        </section>
        
        <section class="section" id="men">
            <div class="section-title"><h2>عطرهای مردانه</h2></div>
            <div class="products-container"><div class="products-grid" id="menPerfumes"></div></div>
        </section>
        
        <section class="section" style="background: #f8f9fa;" id="women">
            <div class="section-title"><h2>عطرهای زنانه</h2></div>
            <div class="products-container"><div class="products-grid" id="womenPerfumes"></div></div>
        </section>
        
        <section class="section" id="unisex">
            <div class="section-title"><h2>عطرهای یونی‌سکس</h2></div>
            <div class="products-container"><div class="products-grid"id="unisexPerfumes"></div></div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" id="contact">
        <!-- Footer content will be dynamically updated -->
    </footer>
    
    <!-- Modals -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-header">
            <h3 class="cart-title">سبد خرید شما</h3>
            <button class="close-cart" id="closeCart">&times;</button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-summary">
            <div class="cart-total">
                <span>جمع کل:</span>
                <span id="cartTotal">۰ تومان</span>
            </div>
            <button class="generate-order" id="checkoutButton">
                <i class="fas fa-arrow-left"></i> تایید و ادامه سفارش
            </button>
        </div>
    </div>

    <div class="cart-modal" id="checkoutModal">
        <div class="checkout-modal-content">
            <div class="cart-header">
                <h3 class="cart-title">تکمیل سفارش</h3>
                <button class="close-cart" id="closeCheckout">&times;</button>
            </div>
            <div class="checkout-steps">
                <div class="checkout-progress" id="checkoutProgress"></div>
                <div class="checkout-step" id="step1-container"><div class="step-number">1</div><div class="step-title">اطلاعات ارسال</div></div>
                <div class="checkout-step" id="step2-container"><div class="step-number">2</div><div class="step-title">روش ارسال</div></div>
                <div class="checkout-step" id="step3-container"><div class="step-number">3</div><div class="step-title">پرداخت</div></div>
            </div>
            <!-- Step 1: Shipping Info -->
            <div class="checkout-form-container active" id="shippingInfoForm">
                <div class="checkout-form">
                    <div class="form-group"><label for="fullName" class="form-label">نام و نام خانوادگی گیرنده</label><input type="text" id="fullName" class="form-control"></div>
                    <div class="form-group"><label for="phoneNumber" class="form-label">شماره تماس گیرنده <span class="label-note">(انگلیسی)</span></label><input type="tel" id="phoneNumber" class="form-control"></div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="provinceSearch" class="form-label">استان</label>
                                <input type="text" id="provinceSearch" class="form-control" placeholder="جستجوی استان...">
                                <select id="province" class="form-control" size="5" style="margin-top: 5px;"></select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="citySearch" class="form-label">شهر</label>
                                <input type="text" id="citySearch" class="form-control" placeholder="جستجوی شهر...">
                                <select id="city" class="form-control" size="5" style="margin-top: 5px;"></select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group"><label for="address" class="form-label">آدرس کامل</label><textarea id="address" class="form-control" rows="3"></textarea></div>
                    <div class="form-group"><label for="postalCode" class="form-label">کد پستی <span class="label-note">(انگلیسی)</span></label><input type="text" id="postalCode" class="form-control"></div>
                </div>
                <div class="checkout-actions">
                    <button class="btn btn-secondary" id="cancelCheckout">انصراف</button>
                    <button class="btn btn-primary" id="nextToShippingMethod">مرحله بعد</button>
                </div>
            </div>
            <!-- Other steps will be dynamically inserted here -->
        </div>
    </div>

    <div class="cart-modal" id="wishlistModal">
        <div class="cart-header">
            <h3 class="cart-title">لیست علاقه‌مندی‌ها</h3>
            <button class="close-cart" id="closeWishlist">&times;</button>
        </div>
        <div class="cart-items" id="wishlistItems"></div>
    </div>

    <div class="product-modal" id="productModal">
        <div class="product-modal-content">
            <button class="close-product-modal" id="closeProductModal">&times;</button>
            <div class="product-detail-container" id="productDetailContent"></div>
        </div>
    </div>

    <div class="size-modal" id="sizeModal">
        <div class="size-modal-content">
            <button class="close-size-modal" id="closeSizeModal">&times;</button>
            <h3 class="size-modal-title" id="sizeModalTitle">انتخاب حجم</h3>
            <div class="size-options-modal" id="sizeOptions"></div>
            <button class="add-to-cart-size" id="addToCartSize">افزودن به سبد خرید</button>
        </div>
    </div>

    <div class="generic-modal" id="profileModal"></div>
    <div class="generic-modal" id="ordersModal"></div>
    <div class="generic-modal" id="adminModal">
        <div class="generic-modal-content">
            <button class="close-generic-modal" data-modal-id="adminModal">&times;</button>
            <h3 class="generic-modal-title">پنل مدیریت سفارشات</h3>
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>شماره سفارش</th>
                            <th>مشتری</th>
                            <th>تاریخ</th>
                            <th>مبلغ کل</th>
                            <th>وضعیت</th>
                            <th>فیش واریزی</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="adminOrdersTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    <div class="toast" id="toast"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATION ---
            const firebaseConfig = {
                apiKey: "AIzaSyA-5z_1keyBEMxW-iA2WQK4fAznG10uQ78",
                authDomain: "hamsarperfume-83cb6.firebaseapp.com",
                projectId: "hamsarperfume-83cb6",
                storageBucket: "hamsarperfume-83cb6.firebasestorage.app",
                messagingSenderId: "926272445971",
                appId: "1:926272445971:web:051c76a5ed4af23f1e29e6"
            };
            const EMAILJS_SERVICE_ID = 'service_93422fg';
            const EMAILJS_TEMPLATE_ID = 'template_d6wdpb4';
            const EMAILJS_PUBLIC_KEY = 'xluvNfOZ9_o0SFRVi';
            const IMGBB_API_KEY = 'de55bc5b6525015fc1ef403f5adbb2f9';
            const ADMIN_UID = 'YOUR_ADMIN_UID_HERE'; 

            // --- INITIALIZATION ---
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            emailjs.init(EMAILJS_PUBLIC_KEY);

            // --- STATE ---
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
            let currentUser = null;
            let selectedPerfume = null;
            let selectedSize = null;
            let provinceCityData = {};
            let allProvinces = [];
            let allCities = [];

            // --- DOM ELEMENTS ---
            const menPerfumesGrid = document.getElementById('menPerfumes');
            const womenPerfumesGrid = document.getElementById('womenPerfumes');
            const unisexPerfumesGrid = document.getElementById('unisexPerfumes');
            const cartCount = document.getElementById('cartCount');
            const wishlistCount = document.getElementById('wishlistCount');
            const mobileCartCount = document.querySelector('#mobileCart .badge');
            const mobileWishlistCount = document.querySelector('#mobileWishlist .badge');
            const overlay = document.getElementById('overlay');
            const toast = document.getElementById('toast');
            
            // --- PERFUME DATA ---
            const perfumes = [
                {id:1,name:"شنل پلاتینیوم",category:"men",image:"https://placehold.co/300x300/1a1a2e/FFFFFF?text=شنل",badge:"جدید",sizes:[{size:"۱۰ میل",price:170},{size:"۲۰ میل",price:290},{size:"۳۰ میل",price:390},{size:"۵۰ میل",price:650}],description:"عطری کلاسیک و لوکس با رایحه‌ای چوبی و تند.",specs:{"برند":"شنل","پخش بو":"زیاد"}},
                {id:2,name:"تایگار",category:"men",image:"https://placehold.co/300x300/1a1a2e/FFFFFF?text=تایگار",badge:"پرفروش",sizes:[{size:"۱۰ میل",price:190},{size:"۲۰ میل",price:320},{size:"۳۰ میل",price:430},{size:"۵۰ میل",price:700}],description:"رایحه‌ای تازه و مرکباتی با نت‌های گریپ فروت و چوب.",specs:{"برند":"بولگاری","پخش بو":"زیاد"}},
                {id:3,name:"مارلی آلتیر",category:"men",image:"https://placehold.co/300x300/1a1a2e/FFFFFF?text=آلتیر",badge:"پرفروش",sizes:[{size:"۱۰ میل",price:190},{size:"۲۰ میل",price:320},{size:"۳۰ میل",price:430},{size:"۵۰ میل",price:700}],description:"عطری گرم و شیرین با نت‌های وانیل و دارچین.",specs:{"برند":"مارلی","پخش بو":"زیاد"}},
                {id:25,name:"بیلی آیلیش",category:"women",image:"https://placehold.co/300x300/E94560/FFFFFF?text=بیلی",badge:"ویژه",sizes:[{size:"۱۰ میل",price:250},{size:"۲۰ میل",price:450},{size:"۳۰ میل",price:590},{size:"۵۰ میل",price:950}],description:"رایحه‌ای مدرن و جوان‌پسند با نت‌های توت و وانیل.",specs:{"برند":"بیلی آیلیش","پخش بو":"متوسط"}},
                {id:31,name:"تام فورد لاست چری",category:"women",image:"https://placehold.co/300x300/E94560/FFFFFF?text=لاست+چری",badge:"جدید",sizes:[{size:"۱۰ میل",price:210},{size:"۲۰ میل",price:380},{size:"۳۰ میل",price:430},{size:"۵۰ میل",price:700}],description:"رایحه‌ای میوه‌ای با تاکید بر گیلاس و بادام.",specs:{"برند":"تام فورد","پخش بو":"متوسط"}},
                {id:35,name:"آمواج گایدنس",category:"unisex",image:"https://placehold.co/300x300/0f3460/FFFFFF?text=گایدنس",sizes:[{size:"۱۰ میل",price:190},{size:"۲۰ میل",price:320},{size:"۳۰ میل",price:430},{size:"۵۰ میل",price:700}],description:"حس شرقی-ادویه‌ای با تأکید بر عنبر و مشک.",specs:{"برند":"آمواج","پخش بو":"متوسط"}}
            ];

            // --- CORE FUNCTIONS ---
            const showToast = (message, isError = false) => {
                toast.textContent = message;
                toast.style.backgroundColor = isError ? '#e74c3c' : 'rgba(26, 26, 46, 0.9)';
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            };

            const openModal = (modal, useOverlay = true) => {
                if (useOverlay) overlay.classList.add('active');
                modal.classList.add('active');
                if (modal.classList.contains('cart-modal')) modal.classList.add('open');
                document.body.style.overflow = 'hidden';
            };

            const closeModal = (modal, useOverlay = true) => {
                if (!modal) return;
                if (useOverlay) overlay.classList.remove('active');
                modal.classList.remove('active');
                if (modal.classList.contains('cart-modal')) modal.classList.remove('open');
                if (!document.querySelector('.active')) {
                     document.body.style.overflow = '';
                }
            };
            
            // --- UI RENDERING ---
            const generateProductCards = () => {
                menPerfumesGrid.innerHTML = '';
                womenPerfumesGrid.innerHTML = '';
                unisexPerfumesGrid.innerHTML = '';
                
                perfumes.forEach(perfume => {
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';
                    
                    productCard.innerHTML = `
                        <div class="product-image">
                            <img src="${perfume.image}" alt="${perfume.name}" loading="lazy">
                            ${perfume.badge ? `<span class="product-badge">${perfume.badge}</span>` : ''}
                        </div>
                        <div class="product-info">
                            <h3 class="product-title">${perfume.name}</h3>
                            <div class="product-bottom">
                                <div class="product-price">${perfume.sizes[0].price.toLocaleString('fa-IR')}٬۰۰۰ تومان</div>
                                <div class="product-actions">
                                    <button class="action-btn wishlist-btn"><i class="far fa-heart"></i></button>
                                    <button class="action-btn add-to-cart-btn"><i class="fas fa-plus"></i></button>
                                </div>
                            </div>
                        </div>`;

                    productCard.querySelector('.add-to-cart-btn').addEventListener('click', (e) => {
                        e.stopPropagation();
                        openSizeModal(perfume);
                    });

                    const wishlistBtn = productCard.querySelector('.wishlist-btn');
                    wishlistBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        toggleWishlist(perfume, wishlistBtn);
                    });
                    updateWishlistButton(perfume.id, wishlistBtn);

                    productCard.addEventListener('click', () => showProductDetails(perfume));
                    
                    if (perfume.category === 'men') menPerfumesGrid.appendChild(productCard);
                    else if (perfume.category === 'women') womenPerfumesGrid.appendChild(productCard);
                    else unisexPerfumesGrid.appendChild(productCard);
                });
            };

            const updateCartUI = () => {
                const cartItemsEl = document.getElementById('cartItems');
                const cartTotalEl = document.getElementById('cartTotal');
                if (!cartItemsEl || !cartTotalEl) return;
                
                cartItemsEl.innerHTML = '';
                if (cart.length === 0) {
                    cartItemsEl.innerHTML = '<p style="text-align:center; padding: 20px;">سبد خرید شما خالی است.</p>';
                    cartTotalEl.textContent = '۰ تومان';
                    return;
                }

                let total = 0;
                cart.forEach((item, index) => {
                    total += item.price * item.quantity;
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <div class="cart-item-image"><img src="${item.image}" alt="${item.name}"></div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-size">حجم: ${item.size}</div>
                            <div class="cart-item-price">${(item.price * item.quantity).toLocaleString('fa-IR')}٬۰۰۰ تومان</div>
                        </div>
                        <button class="cart-item-remove" data-index="${index}"><i class="fas fa-trash"></i></button>`;
                    cartItemsEl.appendChild(cartItem);
                });
                cartTotalEl.textContent = `${total.toLocaleString('fa-IR')}٬۰۰۰ تومان`;

                document.querySelectorAll('.cart-item-remove').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        cart.splice(parseInt(e.currentTarget.dataset.index), 1);
                        localStorage.setItem('cart', JSON.stringify(cart));
                        updateCartUI();
                        updateCounters();
                    });
                });
            };
            
            // --- FUNCTIONALITY ---
            const updateCounters = () => {
                const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCount.textContent = cartItemCount;
                wishlistCount.textContent = wishlist.length;
                if(mobileCartCount) mobileCartCount.textContent = cartItemCount;
                if(mobileWishlistCount) mobileWishlistCount.textContent = wishlist.length;
            };

            const openSizeModal = (perfume) => {
                selectedPerfume = perfume;
                selectedSize = null;
                const sizeModal = document.getElementById('sizeModal');
                document.getElementById('sizeModalTitle').textContent = perfume.name;
                const sizeOptionsEl = document.getElementById('sizeOptions');
                sizeOptionsEl.innerHTML = '';

                perfume.sizes.forEach(size => {
                    const option = document.createElement('div');
                    option.className = 'size-option-detail'; // Reusing style
                    option.dataset.size = size.size;
                    option.dataset.price = size.price;
                    option.innerHTML = `<span>${size.size}</span><span class="size-price">${size.price.toLocaleString('fa-IR')}٬۰۰۰ تومان</span>`;
                    option.addEventListener('click', () => {
                        sizeOptionsEl.querySelectorAll('.size-option-detail').forEach(o => o.classList.remove('active'));
                        option.classList.add('active');
                        selectedSize = size;
                    });
                    sizeOptionsEl.appendChild(option);
                });
                openModal(sizeModal);
            };
            
            const addToCart = (perfume, size, price) => {
                 const existingItem = cart.find(item => item.id === perfume.id && item.size === size);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ id: perfume.id, name: perfume.name, size, price, image: perfume.image, quantity: 1 });
                }
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCounters();
                showToast('محصول به سبد خرید اضافه شد!');
            };

            const updateWishlistButton = (perfumeId, button) => {
                const isInWishlist = wishlist.some(item => item.id === perfumeId);
                button.innerHTML = `<i class="${isInWishlist ? 'fas' : 'far'} fa-heart"></i>`;
                button.style.color = isInWishlist ? 'var(--accent)' : '';
            };
            
            const toggleWishlist = (perfume, btn) => {
                const index = wishlist.findIndex(item => item.id === perfume.id);
                if (index > -1) {
                    wishlist.splice(index, 1);
                    showToast('از علاقه‌مندی‌ها حذف شد');
                } else {
                    wishlist.push({ id: perfume.id, name: perfume.name, image: perfume.image });
                    showToast('به علاقه‌مندی‌ها اضافه شد');
                }
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
                updateWishlistButton(perfume.id, btn);
                updateCounters();
                generateProductCards(); // To update all cards
            };

            const showProductDetails = (perfume) => {
                const modal = document.getElementById('productModal');
                const content = document.getElementById('productDetailContent');
                content.innerHTML = `
                    <div class="product-detail-image"><img src="${perfume.image}" alt="${perfume.name}"></div>
                    <div class="product-detail-info">
                        <h2 class="product-detail-title">${perfume.name}</h2>
                        <div class="product-detail-price">${perfume.sizes[0].price.toLocaleString('fa-IR')}٬۰۰۰ تومان</div>
                        <p>${perfume.description}</p>
                        <div class="product-detail-sizes">
                            <h3>حجم محصول:</h3>
                            <div class="size-grid">
                                ${perfume.sizes.map(s => `<div class="size-option-detail" data-price="${s.price}"><span>${s.size}</span><span class="size-price">${s.price.toLocaleString('fa-IR')}٬۰۰۰ تومان</span></div>`).join('')}
                            </div>
                        </div>
                        <div class="product-detail-actions">
                            <button class="add-to-cart-detail"><i class="fas fa-shopping-cart"></i> افزودن به سبد خرید</button>
                            <button class="wishlist-btn-detail"><i class="far fa-heart"></i></button>
                        </div>
                    </div>`;
                
                const wishlistBtn = content.querySelector('.wishlist-btn-detail');
                updateWishlistButton(perfume.id, wishlistBtn);
                wishlistBtn.addEventListener('click', () => toggleWishlist(perfume, wishlistBtn));

                openModal(modal);
            };

            // --- AUTHENTICATION ---
            auth.onAuthStateChanged(user => {
                currentUser = user;
                // Update UI based on auth state
            });

            // --- PROVINCE & CITY DATA (EMBEDDED) ---
            const iranProvinces = [
                {"id":1,"name":"آذربایجان شرقی"}, {"id":2,"name":"آذربایجان غربی"}, {"id":3,"name":"اردبیل"}, {"id":4,"name":"اصفهان"}, {"id":5,"name":"البرز"}, {"id":6,"name":"ایلام"}, {"id":7,"name":"بوشهر"}, {"id":8,"name":"تهران"}, {"id":9,"name":"چهارمحال و بختیاری"}, {"id":10,"name":"خراسان جنوبی"}, {"id":11,"name":"خراسان رضوی"}, {"id":12,"name":"خراسان شمالی"}, {"id":13,"name":"خوزستان"}, {"id":14,"name":"زنجان"}, {"id":15,"name":"سمنان"}, {"id":16,"name":"سیستان و بلوچستان"}, {"id":17,"name":"فارس"}, {"id":18,"name":"قزوین"}, {"id":19,"name":"قم"}, {"id":20,"name":"کردستان"}, {"id":21,"name":"کرمان"}, {"id":22,"name":"کرمانشاه"}, {"id":23,"name":"کهگیلویه و بویراحمد"}, {"id":24,"name":"گلستان"}, {"id":25,"name":"گیلان"}, {"id":26,"name":"لرستان"}, {"id":27,"name":"مازندران"}, {"id":28,"name":"مرکزی"}, {"id":29,"name":"هرمزگان"}, {"id":30,"name":"همدان"}, {"id":31,"name":"یزد"}
            ];
            const iranCities = [
                {"id":1,"name":"آذرشهر","province_id":1}, {"id":6,"name":"تبریز","province_id":1}, {"id":13,"name":"مراغه","province_id":1},
                {"id":20,"name":"ارومیه","province_id":2}, {"id":26,"name":"خوی","province_id":2}, {"id":32,"name":"مهاباد","province_id":2},
                {"id":35,"name":"اردبیل","province_id":3}, {"id":38,"name":"خلخال","province_id":3},
                {"id":47,"name":"اصفهان","province_id":4}, {"id":61,"name":"کاشان","province_id":4}, {"id":66,"name":"نجف‌آباد","province_id":4},
                {"id":72,"name":"کرج","province_id":5}, {"id":69,"name":"ساوجبلاغ","province_id":5},
                {"id":75,"name":"ایلام","province_id":6}, {"id":83,"name":"مهران","province_id":6},
                {"id":84,"name":"بوشهر","province_id":7}, {"id":87,"name":"دشتستان","province_id":7},
                {"id":99,"name":"تهران","province_id":8}, {"id":104,"name":"شهریار","province_id":8}, {"id":94,"name":"اسلام‌شهر","province_id":8},
                {"id":114,"name":"شهرکرد","province_id":9}, {"id":111,"name":"بروجن","province_id":9},
                {"id":120,"name":"بیرجند","province_id":10}, {"id":127,"name":"فردوس","province_id":10},
                {"id":152,"name":"مشهد","province_id":11}, {"id":144,"name":"سبزوار","province_id":11}, {"id":154,"name":"نیشابور","province_id":11},
                {"id":156,"name":"بجنورد","province_id":12}, {"id":159,"name":"شیروان","province_id":12},
                {"id":168,"name":"اهواز","province_id":13}, {"id":175,"name":"دزفول","province_id":13}, {"id":163,"name":"آبادان","province_id":13},
                {"id":194,"name":"زنجان","province_id":14}, {"id":190,"name":"ابهر","province_id":14},
                {"id":200,"name":"سمنان","province_id":15}, {"id":201,"name":"شاهرود","province_id":15},
                {"id":210,"name":"زاهدان","province_id":16}, {"id":209,"name":"زابل","province_id":16}, {"id":206,"name":"چابهار","province_id":16},
                {"id":239,"name":"شیراز","province_id":17}, {"id":244,"name":"کازرون","province_id":17}, {"id":230,"name":"جهرم","province_id":17},
                {"id":258,"name":"قزوین","province_id":18}, {"id":257,"name":"تاکستان","province_id":18},
                {"id":259,"name":"قم","province_id":19},
                {"id":266,"name":"سنندج","province_id":20}, {"id":265,"name":"سقز","province_id":20}, {"id":269,"name":"مریوان","province_id":20},
                {"id":288,"name":"کرمان","province_id":21}, {"id":282,"name":"سیرجان","province_id":21}, {"id":278,"name":"رفسنجان","province_id":21},
                {"id":303,"name":"کرمانشاه","province_id":22}, {"id":293,"name":"اسلام‌آباد غرب","province_id":22},
                {"id":308,"name":"بویراحمد","province_id":23}, {"id":313,"name":"گچساران","province_id":23},
                {"id":324,"name":"گرگان","province_id":24}, {"id":326,"name":"گنبد کاووس","province_id":24},
                {"id":334,"name":"رشت","province_id":25}, {"id":332,"name":"بندر انزلی","province_id":25}, {"id":342,"name":"لاهیجان","province_id":25},
                {"id":349,"name":"خرم‌آباد","province_id":26}, {"id":347,"name":"بروجرد","province_id":26},
                {"id":364,"name":"ساری","province_id":27}, {"id":357,"name":"بابل","province_id":27}, {"id":369,"name":"قائم‌شهر","province_id":27},
                {"id":378,"name":"اراک","province_id":28}, {"id":384,"name":"ساوه","province_id":28},
                {"id":392,"name":"بندر عباس","province_id":29}, {"id":401,"name":"میناب","province_id":29},
                {"id":410,"name":"همدان","province_id":30}, {"id":408,"name":"ملایر","province_id":30},
                {"id":420,"name":"یزد","province_id":31}, {"id":419,"name":"میبد","province_id":31}
            ];
            
            const processLocationData = () => {
                allProvinces = iranProvinces;
                allCities = iranCities;
                provinceCityData = allProvinces.reduce((acc, p) => {
                    acc[p.id] = allCities.filter(c => c.province_id === p.id);
                    return acc;
                }, {});
                populateProvinces(allProvinces);
            };
            
            const populateProvinces = (provinces) => {
                const select = document.getElementById('province');
                select.innerHTML = provinces.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            };

            const populateCities = (cities) => {
                document.getElementById('city').innerHTML = cities.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
            };

            // --- EVENT LISTENERS ---
            document.getElementById('addToCartSize').addEventListener('click', () => {
                if (selectedPerfume && selectedSize) {
                    addToCart(selectedPerfume, selectedSize.size, selectedSize.price);
                    closeModal(document.getElementById('sizeModal'));
                } else {
                    showToast('لطفاً حجم را انتخاب کنید', true);
                }
            });
            
            document.getElementById('cartIcon').addEventListener('click', () => {
                updateCartUI();
                openModal(document.getElementById('cartModal'));
            });
            document.getElementById('wishlistIcon').addEventListener('click', () => openModal(document.getElementById('wishlistModal')));
            document.getElementById('searchIcon').addEventListener('click', () => openModal(document.getElementById('searchHeader'), false));
            document.getElementById('closeSearch').addEventListener('click', () => closeModal(document.getElementById('searchHeader'), false));
            document.getElementById('hamburger').addEventListener('click', () => {
                document.getElementById('hamburger').classList.toggle('active');
                document.getElementById('mobileMenu').classList.toggle('active');
            });

            overlay.addEventListener('click', () => {
                document.querySelectorAll('.active').forEach(el => closeModal(el));
                document.getElementById('hamburger').classList.remove('active');
            });

            document.querySelectorAll('.close-cart, .close-product-modal, .close-size-modal, .close-auth-modal, .close-generic-modal').forEach(btn => {
                btn.addEventListener('click', (e) => closeModal(e.currentTarget.closest('.active')));
            });

            // --- INITIALIZE APP ---
            generateProductCards();
            updateCounters();
            processLocationData();
        });
    </script>
</body>
</html>
