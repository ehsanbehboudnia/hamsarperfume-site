<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>همسر پرفیوم - فروشگاه تخصصی عطرهای لاکچری</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        /* --- START: CSS VARIABLES & RESET --- */
        :root {
            --primary: #1a1a2e;
            --secondary: #2d4263;
            --accent: #c84b31;
            --accent-light: #d66853;
            --light: #f8f5f1;
            --dark: #191919;
            --text: #333;
            --white: #ffffff;
            --gray: #f8f9fa;
            --success: #4CAF50;
            --gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --transition: all 0.3s ease;
            --shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            --radius: 12px;
            --glass: rgba(255, 255, 255, 0.15);
            --glass-dark: rgba(26, 26, 46, 0.8);
            --blur: blur(10px);
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-right: env(safe-area-inset-right);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
            --safe-area-inset-left: env(safe-area-inset-left);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
            background-color: var(--white);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            font-weight: 300;
        }

        body.modal-open {
            overflow: hidden;
        }
        /* --- END: CSS VARIABLES & RESET --- */

        /* --- START: BASE MOBILE STYLES --- */

        /* Header */
        .header {
            background: var(--white);
            padding: 15px 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: calc(15px + var(--safe-area-inset-top));
        }
        
        .header-container {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: 15px;
            width: 100%;
        }
        
        .nav-desktop {
            display: none;
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .hamburger span {
            height: 2px;
            width: 100%;
            background: var(--primary);
            border-radius: 3px;
            transition: var(--transition);
        }
        
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -6px); }
        
        .logo {
            display: flex;
            align-items: center;
            color: var(--primary);
            text-decoration: none;
            font-size: 20px;
            font-weight: 700;
            gap: 10px;
            justify-self: center;
        }
        
        .logo-text { font-weight: 800; color: var(--primary); }
        .logo-image { width: 35px; height: 35px; border-radius: 10%; object-fit: cover; }
        
        .header-icons {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-self: end;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }
        .icon-btn:hover { color: var(--accent); }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 1px solid var(--accent-light);
        }
        
        .badge {
            position: absolute;
            top: -8px;
            left: -10px;
            background: var(--accent);
            color: var(--white);
            font-size: 12px;
            font-weight: bold;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Mobile Menu */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 300px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: var(--blur);
            z-index: 1000;
            transition: right 0.3s ease;
            padding: 80px 20px 20px;
            overflow-y: auto;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
            padding-bottom: var(--safe-area-inset-bottom);
        }
        .mobile-menu.active { right: 0; }
        .mobile-nav { display: flex; flex-direction: column; gap: 15px; }
        .mobile-nav-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 18px;
            padding: 12px 20px;
            border-radius: 8px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(248, 249, 250, 0.5);
        }
        .mobile-nav-link:hover { background: rgba(200, 75, 49, 0.1); }
        .mobile-nav-link i { font-size: 20px; min-width: 25px; color: var(--accent); }

        /* Hero Section */
        .hero {
            height: 400px;
            background: url(http://hamsar.wuaze.com/wp-content/uploads/2024/03/bg-10.jpg) no-repeat center center;
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 20px;
            position: relative;
            margin-bottom: 40px;
            width: 100%;
            border-radius: 0;
        }
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 0;
            border-radius: inherit;
        }
        .hero-content { max-width: 800px; position: relative; z-index: 1; }
        .hero-title {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .hero-subtitle {
            font-size: 1.1rem;
            color: var(--white);
            margin-bottom: 40px;
            font-weight: 300;
        }

        /* General Section & Products */
        .section { padding: 40px 15px; }
        .section-title { text-align: center; margin-bottom: 30px; }
        .section-title h2 {
            font-size: 1.8rem;
            color: var(--dark);
            font-weight: 400;
            display: inline-block;
            padding-bottom: 15px;
            position: relative;
        }
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--accent);
        }
        .products-container { max-width: 1400px; margin: 0 auto; }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(140px, 1fr));
            gap: 12px;
        }
        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            border: 1px solid #f0f0f0;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); }
        .product-image { height: 160px; display: flex; align-items: center; justify-content: center; position: relative; }
        .product-image img { width: 80%; height: 80%; object-fit: contain; transition: var(--transition); }
        .product-card:hover .product-image img { transform: scale(1.05); }
        .product-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--accent);
            color: var(--white);
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 12px;
        }
        .product-info { padding: 15px; flex: 1; display: flex; flex-direction: column; }
        .product-title {
            font-size: 15px;
            font-weight: 400;
            margin-bottom: 15px;
            color: var(--dark);
            text-align: center;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .product-bottom { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .product-price { font-size: 16px; font-weight: 500; color: var(--accent); }
        .product-actions { display: flex; gap: 10px; }
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray);
            border: none;
            cursor: pointer;
            transition: var(--transition);
            font-size: 15px;
        }
        .action-btn:hover { background: var(--accent); color: white; }

        /* Modals (General) */
        .modal, .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .modal { z-index: 2000; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .overlay { z-index: 999; background: rgba(0, 0, 0, 0.7); }
        .modal.active, .overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: var(--blur);
            width: 100%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-modal-btn {
            position: absolute; top: 15px; right: 15px; background: var(--accent); color: white;
            border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 16px;
            cursor: pointer; z-index: 10; display: flex; justify-content: center; align-items: center;
        }

        /* Auth Modal */
        #authModal .modal-content { max-width: 500px; }
        .auth-tabs { display: flex; margin-bottom: 25px; border-bottom: 1px solid #eee; }
        .auth-tab { padding: 12px 20px; cursor: pointer; font-weight: 600; color: #777; transition: var(--transition); position: relative; flex: 1; text-align: center; }
        .auth-tab.active { color: var(--accent); }
        .auth-tab.active::after { content: ''; position: absolute; bottom: -1px; right: 0; width: 100%; height: 2px; background: var(--accent); }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .auth-form-group { margin-bottom: 20px; }
        .auth-form-label { display: block; margin-bottom: 8px; font-weight: 400; color: var(--dark); }
        .auth-form-input { width: 100%; padding: 14px; border: 1px solid #eee; border-radius: 8px; font-size: 16px; font-family: 'Vazirmatn', Tahoma, sans-serif; background: #f9f9f9; }
        .auth-form-button { width: 100%; padding: 14px; background: var(--accent); color: var(--white); border: none; border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer; transition: var(--transition); margin-top: 10px; }
        
        /* Side Modal (Cart, Checkout) */
        .side-modal {
            position: fixed; top: 0; right: -100%;
            width: 95%; max-width: 420px; height: 100vh;
            background: rgba(255, 255, 255, 0.98); backdrop-filter: var(--blur);
            z-index: 1500; transition: right 0.4s ease;
            display: flex; flex-direction: column; box-shadow: -2px 0 15px rgba(0,0,0,0.08);
        }
        .side-modal.open { right: 0; }
        .side-modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #eee; padding-top: calc(20px + var(--safe-area-inset-top)); }
        .side-modal-title { font-size: 22px; font-weight: 400; }
        .close-side-modal { background: none; border: none; font-size: 28px; cursor: pointer; color: #777; }
        .side-modal-body { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .side-modal-footer { padding: 20px; border-top: 1px solid #eee; background: rgba(255, 255, 255, 0.9); padding-bottom: calc(20px + var(--safe-area-inset-bottom)); }

        /* Cart & Wishlist Items */
        .cart-item { display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #eee; }
        .cart-item-image { width: 80px; height: 80px; background: #f5f5f5; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .cart-item-image img { max-width: 75%; max-height: 75%; }
        .cart-item-details { flex: 1; }
        .cart-item-name { font-weight: 500; margin-bottom: 8px; font-size: 15px; }
        .cart-item-price { font-weight: 500; color: var(--accent); font-size: 16px; }
        .cart-item-remove { color: #ff6b6b; background: none; border: none; font-size: 20px; cursor: pointer; }
        .final-total { display: flex; justify-content: space-between; font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        .checkout-button { width: 100%; padding: 15px; background: var(--accent); color: var(--white); border: none; border-radius: 8px; font-weight: 500; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .checkout-button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        /* Footer */
        .footer { background: var(--dark); color: var(--white); padding: 50px 20px 20px; padding-bottom: calc(20px + var(--safe-area-inset-bottom)); }
        .footer-content { display: grid; grid-template-columns: 1fr; gap: 40px; margin-bottom: 30px; }
        .footer-section h3 { font-size: 20px; margin-bottom: 20px; color: var(--accent-light); position: relative; padding-bottom: 12px; }
        .footer-section h3::after { content: ''; position: absolute; bottom: 0; left: 0; width: 50px; height: 2px; background: var(--accent); }
        .footer-section ul { list-style: none; }
        .footer-section ul li a { color: #ccc; text-decoration: none; }
        .social-links { display: flex; gap: 18px; margin-top: 25px; }
        .social-links a { display: flex; align-items: center; justify-content: center; width: 45px; height: 45px; background: rgba(255, 255, 255, 0.1); color: var(--white); border-radius: 50%; font-size: 18px; }
        .copyright { text-align: center; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); color: #aaa; font-size: 14px; }
        
        /* Product Detail Modal */
        #productModal .modal-content { max-width: 900px; padding: 0; }
        .product-detail-container { display: flex; flex-direction: column; }
        .product-detail-image { flex: 1; min-height: 300px; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .product-detail-image img { max-width: 80%; max-height: 80%; object-fit: contain; }
        .product-detail-info { flex: 1; padding: 25px; }
        .product-detail-title { font-size: 24px; margin-bottom: 15px; }
        .product-detail-price { font-size: 22px; color: var(--accent); margin-bottom: 20px; }
        .product-detail-actions { display: flex; gap: 15px; margin-top: 15px; }
        .add-to-cart-detail { flex: 1; background: var(--accent); color: var(--white); border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 15px; }
        .wishlist-btn-detail { width: 50px; height: 50px; background: var(--white); border: 1px solid #e0e0e0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

        /* Search Bar */
        .search-header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.98); backdrop-filter: var(--blur);
            padding: 15px; z-index: 1100;
            transform: translateY(-150%); transition: transform 0.4s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding-top: calc(15px + var(--safe-area-inset-top));
        }
        .search-header.active { transform: translateY(0); }
        .search-header-container { display: flex; align-items: center; gap: 15px; }
        .close-search { background: none; border: none; font-size: 24px; cursor: pointer; }
        .search-input { flex: 1; padding: 14px 20px; border: 1px solid #e0e0e0; border-radius: 50px; font-size: 16px; background: #f9f9f9; }

        /* Checkout Styles */
        .checkout-steps { display: flex; justify-content: space-around; margin-bottom: 30px; position: relative; padding: 0 10px; }
        .checkout-step { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2; flex: 1; text-align: center; }
        .step-indicator { width: 36px; height: 36px; border-radius: 50%; background: #e0e0e0; color: #999; display: flex; align-items: center; justify-content: center; font-weight: 500; margin-bottom: 8px; transition: all 0.4s ease; border: 2px solid #e0e0e0; }
        .step-indicator .fa-check { display: none; }
        .step-title { font-size: 12px; color: #777; }
        .checkout-step.active .step-indicator { background: var(--white); color: var(--accent); border-color: var(--accent); }
        .checkout-step.active .step-title { color: var(--accent); font-weight: 500; }
        .checkout-step.completed .step-indicator { background: var(--success); color: white; border-color: var(--success); }
        .checkout-step.completed .step-indicator .step-number { display: none; }
        .checkout-step.completed .step-indicator .fa-check { display: block; }
        .checkout-progress-bar { position: absolute; top: 17px; left: 0; right: 0; height: 2px; background: #e0e0e0; z-index: 1; }
        .checkout-progress { height: 100%; background: var(--success); width: 0; transition: width 0.5s ease; }
        .checkout-form-container { display: none; }
        .checkout-form-container.active { display: block; }
        .checkout-form { padding: 0; box-shadow: none; }
        .form-row { display: flex; flex-direction: column; gap: 15px; }
        .btn { padding: 12px 25px; border-radius: var(--radius); font-size: 16px; font-weight: 500; cursor: pointer; transition: var(--transition); border: none; flex-grow: 1; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-secondary { background: #f0f0f0; color: #555; }
        .checkout-actions { display: flex; justify-content: space-between; margin-top: 30px; gap: 10px; }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: var(--blur);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10000;
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(20px);
            text-align: center;
            bottom: calc(20px + var(--safe-area-inset-bottom));
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        /* --- END: BASE MOBILE STYLES --- */


        /* --- START: TABLET STYLES (min-width: 768px) --- */
        @media (min-width: 768px) {
            .section { padding: 60px 20px; }
            .section-title h2 { font-size: 2.2rem; }
            
            .hero { height: 500px; margin-bottom: 50px; width: 90%; margin-left: auto; margin-right: auto; border-radius: 15px; }
            .hero-title { font-size: 2.5rem; }
            .hero-subtitle { font-size: 1.3rem; }

            .products-grid {
                grid-template-columns: repeat(3, minmax(220px, 1fr));
                gap: 25px;
            }
            .product-image { height: 220px; }
            .product-title { font-size: 16px; }

            .product-detail-container { flex-direction: row; }
            .product-detail-image { min-height: 400px; padding: 30px; }
            .product-detail-info { padding: 30px; }
            
            .footer-content {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                max-width: 1400px; margin: 0 auto 40px; padding: 0 40px;
            }

            .form-row { flex-direction: row; }
        }
        /* --- END: TABLET STYLES --- */


        /* --- START: DESKTOP STYLES (min-width: 992px) --- */
        @media (min-width: 992px) {
            .hamburger { display: none; }
            .nav-desktop {
                display: flex;
                gap: 25px;
            }
            .nav-link {
                color: var(--primary); text-decoration: none; font-weight: 400; transition: var(--transition);
                position: relative; padding: 8px 0; font-size: 16px;
            }
            .nav-link:hover { color: var(--accent); }
            .nav-link::after { content: ''; position: absolute; bottom: 0; right: 0; width: 0; height: 1px; background: var(--accent); transition: width 0.3s ease; }
            .nav-link:hover::after { width: 100%; }
            
            .header-container {
                display: flex;
                justify-content: space-between;
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 20px;
                position: relative;
            }
            .logo { position: absolute; left: 50%; transform: translateX(-50%); }
            .nav-desktop { grid-area: nav; justify-self: start; }
            .header-icons { grid-area: icons; justify-self: end; }

            .hero-title { font-size: 3rem; }
            .hero-subtitle { font-size: 1.5rem; }

            .products-grid { grid-template-columns: repeat(4, minmax(220px, 1fr)); }
            .product-image { height: 240px; }
            .product-title { font-size: 18px; }

             /* User Dropdown */
            .user-dropdown { position: relative; }
            .user-dropdown-menu {
                position: absolute; top: 50px; left: 0; background: white;
                min-width: 200px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.08);
                z-index: 1001; opacity: 0; visibility: hidden;
                transform: translateY(10px); transition: all 0.3s ease;
            }
            .user-dropdown:hover .user-dropdown-menu { opacity: 1; visibility: visible; transform: translateY(0); }
            .user-dropdown-item { padding: 12px 20px; display: flex; align-items: center; gap: 10px; color: var(--dark); text-decoration: none; cursor: pointer; }
            .user-dropdown-item:hover { background: #f8f9fa; color: var(--accent); }
        }
        /* --- END: DESKTOP STYLES --- */
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <nav class="nav-desktop">
                <a href="#" class="nav-link">خانه</a>
                <a href="#men" class="nav-link">عطر مردانه</a>
                <a href="#women" class="nav-link">عطر زنانه</a>
                <a href="#unisex" class="nav-link">یونی‌سکس</a>
                <a href="#contact" class="nav-link">تماس با ما</a>
            </nav>
            
            <a href="#" class="logo">
                <div class="logo-text">همسر پرفیوم</div>
                <img src="http://hamsar.wuaze.com/wp-content/uploads/2025/09/پروفایل6-Copy.png" alt="لوگو همسر پرفیوم" class="logo-image">
            </a>
            
            <div class="header-icons">
                <button class="icon-btn" id="searchIcon">
                    <i class="fas fa-search"></i>
                </button>
                <button class="icon-btn" id="wishlistIcon">
                    <i class="far fa-heart"></i>
                    <span class="badge" id="wishlistCount">0</span>
                </button>
                <button class="icon-btn" id="cartIcon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="badge" id="cartCount">0</span>
                </button>
                
                <div class="user-dropdown" id="userDropdown" style="display: none;">
                    <img src="https://via.placeholder.com/150" alt="پروفایل کاربر" class="user-avatar" id="userAvatar">
                    <div class="user-dropdown-menu">
                        <div class="user-dropdown-item" id="profileLink">
                            <i class="fas fa-user"></i> پروفایل
                        </div>
                        <div class="user-dropdown-item" id="ordersLink">
                            <i class="fas fa-shopping-bag"></i> سفارشات
                        </div>
                        <a href="/admin.html" class="user-dropdown-item" id="adminLink" style="display: none;">
                            <i class="fas fa-user-shield"></i> پنل مدیریت
                        </a>
                        <div class="user-dropdown-item" id="logoutLink">
                            <i class="fas fa-sign-out-alt"></i> خروج
                        </div>
                    </div>
                </div>
                
                <button class="icon-btn" id="loginBtn">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </div>
        
        <div class="mobile-menu" id="mobileMenu">
            <nav class="mobile-nav">
                <a href="#" class="mobile-nav-link close-mobile-menu">
                    <i class="fas fa-home"></i> خانه
                </a>
                <a href="#men" class="mobile-nav-link close-mobile-menu">
                    <i class="fas fa-male"></i> عطر مردانه
                </a>
                <a href="#women" class="mobile-nav-link close-mobile-menu">
                    <i class="fas fa-female"></i> عطر زنانه
                </a>
                <a href="#unisex" class="mobile-nav-link close-mobile-menu">
                    <i class="fas fa-venus-mars"></i> یونی‌سکس
                </a>
                <a href="#contact" class="mobile-nav-link close-mobile-menu">
                    <i class="fas fa-phone"></i> تماس با ما
                </a>
                <a href="#" class="mobile-nav-link" id="mobileWishlist">
                    <i class="far fa-heart"></i> لیست علاقه‌مندی‌ها
                    <span class="badge" id="mobileWishlistCount">0</span>
                </a>
                <a href="#" class="mobile-nav-link" id="mobileCart">
                    <i class="fas fa-shopping-cart"></i> سبد خرید
                    <span class="badge" id="mobileCartCount">0</span>
                </a>
                <div class="mobile-nav-link" id="mobileProfile" style="display: none;">
                    <i class="fas fa-user"></i> پروفایل
                </div>
                 <div class="mobile-nav-link" id="mobileOrders" style="display: none;">
                    <i class="fas fa-shopping-bag"></i> سفارشات
                </div>
                <div class="mobile-nav-link" id="mobileLogout" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </div>
                <div class="mobile-nav-link" id="mobileLogin">
                    <i class="fas fa-sign-in-alt"></i> ورود / ثبت‌نام
                </div>
            </nav>
        </div>
    </header>
    
    <div class="modal" id="authModal">
        <div class="modal-content">
            <button class="close-modal-btn" id="closeAuthModal">&times;</button>
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">ورود</div>
                <div class="auth-tab" data-tab="register">ثبت‌نام</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <div class="auth-form-group">
                    <label for="loginEmail" class="auth-form-label">ایمیل</label>
                    <input type="email" id="loginEmail" class="auth-form-input" placeholder="example@example.com">
                </div>
                <div class="auth-form-group">
                    <label for="loginPassword" class="auth-form-label">رمز عبور</label>
                    <input type="password" id="loginPassword" class="auth-form-input" placeholder="رمز عبور">
                </div>
                <button class="auth-form-button" id="loginButton">ورود به حساب</button>
            </div>
            
            <div class="auth-form" id="registerForm">
                 <div class="auth-form-group">
                    <label for="registerName" class="auth-form-label">نام کامل</label>
                    <input type="text" id="registerName" class="auth-form-input" placeholder="نام و نام خانوادگی">
                </div>
                <div class="auth-form-group">
                    <label for="registerPhone" class="auth-form-label">شماره تماس</label>
                    <input type="tel" id="registerPhone" class="auth-form-input" placeholder="09xxxxxxxxx">
                </div>
                <div class="auth-form-group">
                    <label for="registerEmail" class="auth-form-label">ایمیل</label>
                    <input type="email" id="registerEmail" class="auth-form-input" placeholder="example@example.com">
                </div>
                <div class="auth-form-group">
                    <label for="registerPassword" class="auth-form-label">رمز عبور</label>
                    <input type="password" id="registerPassword" class="auth-form-input" placeholder="حداقل ۶ کاراکتر">
                </div>
                <button class="auth-form-button" id="registerButton">ثبت‌نام</button>
            </div>
        </div>
    </div>
    
    <div class="search-header" id="searchHeader">
        <div class="search-header-container">
            <button class="close-search" id="closeSearch">
                <i class="fas fa-arrow-right"></i>
            </button>
            <input type="text" class="search-input" id="searchInput" placeholder="جستجوی محصولات...">
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>
    
    <main>
        <section class="hero">
            <div class="hero-content">
                <h1 class="hero-title">کشف رایحه‌های منحصر به فرد</h1>
                <p class="hero-subtitle">با بهترین عطرهای اورجینال از همسر پرفیوم</p>
            </div>
        </section>
        
        <section class="section" id="men">
            <div class="section-title">
                <h2>عطرهای مردانه</h2>
            </div>
            <div class="products-container">
                <div class="products-grid" id="menPerfumes"></div>
            </div>
        </section>
        
        <section class="section" style="background: #f8f9fa;" id="women">
            <div class="section-title">
                <h2>عطرهای زنانه</h2>
            </div>
            <div class="products-container">
                <div class="products-grid" id="womenPerfumes"></div>
            </div>
        </section>
        
        <section class="section" id="unisex">
            <div class="section-title">
                <h2>عطرهای یونی‌سکس</h2>
            </div>
            <div class="products-container">
                <div class="products-grid" id="unisexPerfumes"></div>
            </div>
        </section>
        
        <section class="section" id="contact">
            </section>
    </main>
    
    <footer class="footer">
        </footer>
    
    <div class="side-modal" id="cartModal">
        <div class="side-modal-header">
            <h3 class="side-modal-title">سبد خرید شما</h3>
            <button class="close-side-modal" id="closeCart">&times;</button>
        </div>
        <div class="side-modal-body" id="cartItems">
            </div>
        <div class="side-modal-footer">
            <div class="cart-summary-row final-total">
                <span>جمع کل:</span>
                <span id="cartTotal">۰ تومان</span>
            </div>
            <button class="checkout-button" id="checkoutButton">
                <i class="fas fa-arrow-left"></i> تایید و ادامه سفارش
            </button>
        </div>
    </div>
    
    <div class="side-modal" id="checkoutModal">
        <div class="side-modal-header">
            <h3 class="side-modal-title">تکمیل سفارش</h3>
            <button class="close-side-modal" id="closeCheckout">&times;</button>
        </div>
        <div class="side-modal-body">
            <div class="checkout-steps">
                 <div class="checkout-progress-bar">
                    <div class="checkout-progress" id="checkoutProgress"></div>
                </div>
                <div class="checkout-step active" id="stepNode1">
                    <div class="step-indicator"><span class="step-number">1</span><i class="fas fa-check"></i></div>
                    <div class="step-title">اطلاعات ارسال</div>
                </div>
                <div class="checkout-step" id="stepNode2">
                    <div class="step-indicator"><span class="step-number">2</span><i class="fas fa-check"></i></div>
                    <div class="step-title">روش ارسال</div>
                </div>
                <div class="checkout-step" id="stepNode3">
                    <div class="step-indicator"><span class="step-number">3</span><i class="fas fa-check"></i></div>
                    <div class="step-title">پرداخت</div>
                </div>
            </div>
            
            <div class="checkout-form-container active" id="shippingInfoForm">
                <div class="checkout-form">
                    <div class="form-group">
                        <label for="fullName" class="form-label">نام و نام خانوادگی گیرنده</label>
                        <input type="text" id="fullName" class="form-control" placeholder="نام کامل به فارسی یا انگلیسی">
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber" class="form-label">شماره تماس گیرنده</label>
                        <input type="tel" id="phoneNumber" class="form-control" placeholder="09xxxxxxxxx">
                         <p class="form-hint">لطفا شماره تماس را با اعداد انگلیسی وارد کنید.</p>
                    </div>
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="province" class="form-label">استان</label>
                                <div class="custom-dropdown">
                                    <input type="text" id="province" class="form-control" placeholder="جستجو یا انتخاب استان">
                                    <div class="dropdown-list" id="provinceList"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label for="city" class="form-label">شهر</label>
                                <div class="custom-dropdown">
                                    <input type="text" id="city" class="form-control" placeholder="جستجو یا انتخاب شهر" disabled>
                                    <div class="dropdown-list" id="cityList"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address" class="form-label">آدرس کامل</label>
                        <textarea id="address" class="form-control" rows="3" placeholder="آدرس کامل پستی شامل خیابان، کوچه، پلاک، واحد"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="postalCode" class="form-label">کد پستی</label>
                        <input type="text" id="postalCode" class="form-control" placeholder="کد پستی ۱۰ رقمی">
                        <p class="form-hint">لطفا کد پستی را با اعداد انگلیسی وارد کنید.</p>
                    </div>
                </div>
            </div>
            
            <div class="checkout-form-container" id="shippingMethodForm">
                </div>
            
            <div class="checkout-form-container" id="paymentForm">
                </div>
            
            <div class="checkout-form-container" id="orderConfirmation">
                </div>
        </div>

        <div class="side-modal-footer" id="checkoutFooter">
             <div class="checkout-actions">
                <button class="btn btn-secondary" id="checkoutBackButton" style="display: none;">مرحله قبل</button>
                <button class="btn btn-primary" id="checkoutNextButton">مرحله بعد</button>
            </div>
        </div>
    </div>
    
    <div class="side-modal" id="wishlistModal">
        <div class="side-modal-header">
            <h3 class="side-modal-title">لیست علاقه‌مندی‌ها</h3>
            <button class="close-side-modal" id="closeWishlist">&times;</button>
        </div>
        <div class="side-modal-body" id="wishlistItems">
            </div>
    </div>
    
    <div class="modal" id="productModal">
        <div class="modal-content">
            <button class="close-modal-btn" id="closeProductModal">&times;</button>
            <div class="product-detail-container" id="productDetailContent"></div>
        </div>
    </div>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="toast" id="toast"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <script>
        // --- START: CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyA-5z_1keyBEMxW-iA2WQK4fAznG10uQ78",
            authDomain: "hamsarperfume-83cb6.firebaseapp.com",
            projectId: "hamsarperfume-83cb6",
            storageBucket: "hamsarperfume-83cb6.appspot.com",
            messagingSenderId: "926272445971",
            appId: "1:926272445971:web:051c76a5ed4af23f1e29e6",
            measurementId: "G-G7QCTQXB8C"
        };

        const emailJsConfig = {
            serviceID: 'service_93422fg',
            templateID: 'template_d6wdpb4',
            publicKey: 'xluvNfOZ9_o0SFRVi'
        };

        const imgbbApiKey = 'de55bc5b6525015fc1ef403f5adbb2f9';
        // --- END: CONFIGURATION ---

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Initialize EmailJS
        emailjs.init(emailJsConfig.publicKey);
        
        // --- START: Perfume Data ---
        const perfumes = [
              // 1
          {
            id: 1,
            name: "شنل پلاتینیوم",
            category: "men",
            image: "assets/image/platinum.jpg",
            badge: "جدید",
            price: 170,
            sizes: [
              { size: "ده میل",   price: 170 },
              { size: "بیست میل",  price: 290 },
              { size: "سی میل",    price: 390 },
              { size: "پنجاه میل", price: 650 },
            ],
            description: "عطری کلاسیک و لوکس با ترکیبی از نت‌های مرکباتی در ابتدا و پایه‌ای از چوب صندل و مشک.",
            specs: {
              "برند": "شنل",
              "نوع رایحه": "مرکباتی – چوبی",
              "پخش بو": "زیاد"
            }
          },
          // 2
          {
            id: 2,
            name: "تایگار",
            category: "men",
            image: "assets/image/تایگار.JPG",
            badge: "پرفروش",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "رایحه‌ای دریایی و تازه با تُن‌های مرکباتی و کمی مشک در پس‌زمینه.",
            specs: {
              "برند": "بولگاری",
              "نوع رایحه": "آبی – مرکباتی",
              "پخش بو": "زیاد"
            }
          },
          // 3
          {
            id: 3,
            name: "مارلی آلتیر",
            category: "men",
            image: "assets/image/التیر.jpg",
            badge: "پرفروش",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "عطری گل‌دار و میوه‌ای با نت‌های یاسمنی در قلب و پایه‌ای خنک از مرکبات.",
            specs: {
              "برند": "مارلی",
              "نوع رایحه": "فلورال – میوه‌ای",
              "پخش بو": "زیاد"
            }
          },
          // 4
          {
            id: 4,
            name: "ایسی میاکی ماجور",
            category: "men",
            image: "https://via.placeholder.com/300",
            badge: "جدید",
            price: "۱۷۰",
            sizes: [
              { size: "ده میل",   price: "۱۷۰" },
              { size: "بیست میل",  price: "۲۹۰" },
              { size: "سی میل",    price: "۳۹۰" },
              { size: "پنجاه میل", price: "۶۵۰" },
            ],
            description: "الهام‌گرفته از فضای کوهستانی با ترکیبی از نت‌های چوبی و ادویه‌ای.",
            specs: {
              "برند": "ایسی میاکی",
              "نوع رایحه": "چوبی – ادویه‌ای",
              "پخش بو": "متوسط"
            }
          },
          // 5
          {
            id: 5,
            name: "کرید سیلور مانتین",
            category: "men",
            image: "assets/image/سیلور.jpg",
            badge: "ویژه",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "حسی کوهستانی و خنک با غالب‌بودن نت‌های چوبی و کهربایی.",
            specs: {
              "برند": "کرید",
              "نوع رایحه": "چوبی – کهربایی",
              "پخش بو": "زیاد"
            }
          },
          // 6
          {
            id: 6,
            name: "گانیمد",
            category: "men",
            image: "assets/image/گانیمد.jpg",
            badge: "جدید",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "عطری مدرن با نت‌های فلورال در ترکیب با چوب صندل و مشک.",
            specs: {
              "برند": "زارجوف",
              "نوع رایحه": "فلورال – چوبی",
              "پخش بو": "متوسط"
            }
          },
          // 7
          {
            id: 7,
            name: "ناتیکا ویاژ",
            category: "men",
            image: "https://via.placeholder.com/300",
            badge: "پرفروش",
            price: "۱۷۰",
            sizes: [
              { size: "ده میل",   price: "۱۷۰" },
              { size: "بیست میل",  price: "۲۹۰" },
              { size: "سی میل",    price: "۳۹۰" },
              { size: "پنجاه میل", price: "۶۵۰" },
            ],
            description: "حسی دریایی و تازه با زمینه‌ای از مرکبات و کمی مشک.",
            specs: {
              "برند": "ناتیکا",
              "نوع رایحه": "آبی – مرکباتی",
              "پخش بو": "متوسط"
            }
          },
          // 8
          {
            id: 8,
            name: "ویکتوریا نایت",
            category: "men",
            image: "assets/image/وری-سکسی-نایت.jpg",
            badge: "جدید",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "نت‌های شرقی-گل‌دار با تاکید بر وانیل و چوب صندل.",
            specs: {
              "برند": "ویکتوریا سیکرت",
              "نوع رایحه": "شرقی – گل‌دار",
              "پخش بو": "زیاد"
            }
          },
          // 9
          {
            id: 9,
            name: "فرعون",
            category: "men",
            image: "https://via.placeholder.com/300",
            badge: "پرفروش",
            price: 210,
            sizes: [
              { size: "ده میل",   price: 210 },
              { size: "بیست میل",  price: 390 },
              { size: "سی میل",    price: 490 },
              { size: "پنجاه میل", price: 800 },
            ],
            description: "رایحه‌ای شرقی و ادویه‌ای با نت‌های وانیل و کهربا.",
            specs: {
              "برند": "ناتیکا",
              "نوع رایحه": "شرقی – ادویه‌ای",
              "پخش بو": "زیاد"
            }
          },
          // 10
          {
            id: 10,
            name: "ایوسن‌لورن وای",
            category: "men",
            image: "assets/image/وای.jpg",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "عطری مرکباتی-گلی با نت‌های لیمو و یاس.",
            specs: {
              "برند": "ایوسن‌لورن",
              "نوع رایحه": "مرکباتی – گلی",
              "پخش بو": "متوسط"
            }
          },
          // 11
          {
            id: 11,
            name: "دیور هوم اینتنس",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "رد بویی قوی با ترکیب چوب سدر و توتون.",
            specs: {
              "برند": "دیور",
              "نوع رایحه": "چوبی – توتون",
              "پخش بو": "زیاد"
            }
          },
          // 12
          {
            id: 12,
            name: "جورجیو آرمانی اکوا دی جیو ابسولو",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "حسی دریایی و خنک با نت‌های مرکبات و نمک دریایی.",
            specs: {
              "برند": "آرمانی",
              "نوع رایحه": "آبی – مرکباتی",
              "پخش بو": "متوسط"
            }
          },
          // 13
          {
            id: 13,
            name: "مارلی هالتان",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "رایحه‌ای قدرتمند و پیچیده با نت‌های گل و کهربا.",
            specs: {
              "برند": "مارلی",
              "نوع رایحه": "گل‌دار – کهربایی",
              "پخش بو": "زیاد"
            }
          },
          // 14
          {
            id: 14,
            name: "الکساندریا2",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "عطری منحصر بفرد با ترکیبی از نت‌های شرقی و چوبی.",
            specs: {
              "برند": "الکساندریا",
              "نوع رایحه": "شرقی – چوبی",
              "پخش بو": "زیاد"
            }
          },
          // 15
          {
            id: 15,
            name: "کرید اونتوس ابسولو",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "پیچیدگی میوه‌ای و دودی در یک بَچ لوکس.",
            specs: {
              "برند": "کرید",
              "نوع رایحه": "میوه‌ای – دودی",
              "پخش بو": "زیاد"
            }
          },
          // 16
          {
            id: 16,
            name: "مارلی کالان",
            categories: ["men", "unisex"],
            image: "https://via.placeholder.com/300",
            price: 490,
            sizes: [
              { size: "سی میل",    price: 490 },
              { size: "پنجاه میل", price: 800 },
            ],
            description: "عطری شرقی و غنی با نت‌های وانیل و مشک.",
            specs: {
              "برند": "مارلی",
              "نوع رایحه": "شرقی – وانیلی",
              "پخش بو": "زیاد"
            }
          },
                    // 
          {
            id: 16,
            name: "مارلی کالان",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 490,
            sizes: [
              { size: "سی میل",    price: 490 },
              { size: "پنجاه میل", price: 800 },
            ],
            description: "عطری شرقی و غنی با نت‌های وانیل و مشک.",
            specs: {
              "برند": "مارلی",
              "نوع رایحه": "شرقی – وانیلی",
              "پخش بو": "زیاد"
            }
          },
          // 17
          {
            id: 17,
            name: "کازاموراتی مفیستو",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 590,
            sizes: [
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "حسی دودی و تنباکویی با لمس کهربا.",
            specs: {
              "برند": "کازاموراتی",
              "نوع رایحه": "دودی – تنباکویی",
              "پخش بو": "زیاد"
            }
          },
          // 18
          {
            id: 18,
            name: "آمواج هانر",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 430,
            sizes: [
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "ترکیبی قوی از چوب سدر و مشک با حس چرمی.",
            specs: {
              "برند": "آمواج",
              "نوع رایحه": "چرمی – چوبی",
              "پخش بو": "زیاد"
            }
          },
          // 19
          {
            id: 19,
            name: "آمواج گایدنس",
            category: "men",
            image: "https://via.placeholder.com/300",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "حس شرقی-ادویه‌ای همراه با نت‌های مشک و عنبر.",
            specs: {
              "برند": "آمواج",
              "نوع رایحه": "شرقی – ادویه‌ای",
              "پخش بو": "متوسط"
            }
          },
          // Women’s perfumes
          // 20
          {
            id: 20,
            name: "بای کیلیان بلومون",
            category: "women",
            image: "assets/image/بلومون2.jpg",
            price: 170,
            sizes: [
              { size: "ده میل",   price: 170 },
              { size: "بیست میل",  price: 290 },
              { size: "سی میل",    price: 390 },
              { size: "پنجاه میل", price: 650 },
            ],
            description: "رایحه‌ای گلی-شرقی با تمرکز بر رز و وانیل.",
            specs: {
              "برند": "بای کیلیان",
              "نوع رایحه": "گل‌دار – شرقی",
              "پخش بو": "متوسط"
            }
          },
          // 21
          {
            id: 21,
            name: "بولگاری اکوا امارا",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 170,
            sizes: [
              { size: "ده میل",   price: 170 },
              { size: "بیست میل",  price: 290 },
              { size: "سی میل",    price: 390 },
              { size: "پنجاه میل", price: 650 },
            ],
            description: "نت‌های دریایی و مرکباتی با پس‌زمینه چوب صندل.",
            specs: {
              "برند": "بولگاری",
              "نوع رایحه": "آبی – مرکباتی",
              "پخش بو": "متوسط"
            }
          },
          // 22
          {
            id: 22,
            name: "زرجوف اکسنتو",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 170,
            sizes: [
              { size: "ده میل",   price: 170 },
              { size: "بیست میل",  price: 290 },
              { size: "سی میل",    price: 390 },
              { size: "پنجاه میل", price: 650 },
            ],
            description: "رایحه‌ای گرم و شرقی با تاکید بر وانیل و چوب صندل.",
            specs: {
              "برند": "زارجوف",
              "نوع رایحه": "شرقی – وانیلی",
              "پخش بو": "متوسط"
            }
          },
          // 23
          {
            id: 23,
            name: "ویکتوریا نایت",
            category: "women",
            image: "assets/image/وری-سکسی-نایت.jpg",
            badge: "جدید",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "حس رمانتیک با ترکیب گل‌های سیاه و وانیل.",
            specs: {
              "برند": "ویکتوریا سیکرت",
              "نوع رایحه": "گل‌دار – شرقی",
              "پخش بو": "زیاد"
            }
          },
          // 24
          {
            id: 24,
            name: "یارا",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "عطری ملایم و گلی با نت‌های یاس و مرکبات.",
            specs: {
              "برند": "نامشخص",
              "نوع رایحه": "گلی – مرکباتی",
              "پخش بو": "متوسط"
            }
          },
          // 25
          {
            id: 25,
            name: "بیلی آیلیش",
            category: "women",
            image: "assets/image/بیلی.jpg",
            badge: "ویژه",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "رایحه‌ای مدرن و جوان‌پسند با نت‌های توت و وانیل.",
            specs: {
              "برند": "بیلی آیلیش",
              "نوع رایحه": "میوه‌ای – شرقی",
              "پخش بو": "متوسط"
            }
          },
          // 26
          {
            id: 26,
            name: "لویی ویتون پسفیک چیل",
            category: "women",
            image: "assets/image/پسفیک.JPG",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "حسی گیاهی-مرکباتی با تمرکز بر رزماری و پرتقال.",
            specs: {
              "برند": "لویی ویتون",
              "نوع رایحه": "گیاهی – مرکباتی",
              "پخش بو": "متوسط"
            }
          },
          // 27
          {
            id: 27,
            name: "لویی ویتون لیمنسیت",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 250,
            sizes: [
              { size: "ده میل",   price: 250 },
              { size: "بیست میل",  price: 450 },
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "رایحه‌ای مرکباتی-سبز با نت غالب لیمو.",
            specs: {
              "برند": "لویی ویتون",
              "نوع رایحه": "مرکباتی – سبز",
              "پخش بو": "متوسط"
            }
          },
          // 28
          {
            id: 28,
            name: "فلورنارکوتیک",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 590,
            sizes: [
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "عطری گل‌دار و میوه‌ای با نت‌های توت و گل‌های بهاری.",
            specs: {
              "برند": "فلورنارکوتیک",
              "نوع رایحه": "گل‌دار – میوه‌ای",
              "پخش بو": "متوسط"
            }
          },
          // 29
          {
            id: 29,
            name: "تیزیانا ترنزی کیرکه",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 430,
            sizes: [
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "نت‌های شرقی-گلی با تاکید بر رز و عنبر.",
            specs: {
              "برند": "تیزیانا ترنزی",
              "نوع رایحه": "شرقی – گلی",
              "پخش بو": "زیاد"
            }
          },
          // 30
          {
            id: 30,
            name: "کازاموراتی بوکت ایدل",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 590,
            sizes: [
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "حسی گلی-چوبی با نت‌های مشک و کهربا.",
            specs: {
              "برند": "کازاموراتی",
              "نوع رایحه": "گلی – چوبی",
              "پخش بو": "زیاد"
            }
          },
          // 31
          {
            id: 31,
            name: "تام فورد لاست چری",
            category: "women",
            image: "assets/image/لاستچری.jpg",
            badge: "جدید",
            price: 430,
            sizes: [
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "رایحه‌ای میوه‌ای با تاکید بر گیلاس و بادام.",
            specs: {
              "برند": "تام فورد",
              "نوع رایحه": "میوه‌ای – گلی",
              "پخش بو": "متوسط"
            }
          },
          // 32
          {
            id: 32,
            name: "کازاموراتی مفیستو",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 590,
            sizes: [
              { size: "سی میل",    price: 590 },
              { size: "پنجاه میل", price: 950 },
            ],
            description: "حسی دودی-چرمی با لمسی از کهربا.",
            specs: {
              "برند": "کازاموراتی",
              "نوع رایحه": "چرمی – دودی",
              "پخش بو": "زیاد"
            }
          },
          // 33
          {
            id: 33,
            name: "آمواج هانر",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 430,
            sizes: [
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "نت‌های چرمی و چوبی با پس‌زمینه مشک.",
            specs: {
              "برند": "آمواج",
              "نوع رایحه": "چرمی – چوبی",
              "پخش بو": "زیاد"
            }
          },
          // 34
          {
            id: 34,
            name: "آمواج گایدنس",
            category: "women",
            image: "https://via.placeholder.com/300",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "حس شرقی-ادویه‌ای با تأکید بر عنبر و مشک.",
            specs: {
              "برند": "آمواج",
              "نوع رایحه": "شرقی – ادویه‌ای",
              "پخش بو": "متوسط"
            }
          },
          // Unisex’s perfumes
          //35
          {
            id: 35,
            name: "آمواج گایدنس",
            category: "unisex",
            image: "https://via.placeholder.com/300",
            price: 190,
            sizes: [
              { size: "ده میل",   price: 190 },
              { size: "بیست میل",  price: 320 },
              { size: "سی میل",    price: 430 },
              { size: "پنجاه میل", price: 700 },
            ],
            description: "حس شرقی-ادویه‌ای با تأکید بر عنبر و مشک.",
            specs: {
              "برند": "آمواج",
              "نوع رایحه": "شرقی – ادویه‌ای",
              "پخش بو": "متوسط"
            }
          },          
        ];
        // --- END: Perfume Data ---

        // --- START: Provinces and Cities Data ---
        const iranData = {
            "آذربایجان شرقی": ["تبریز", "مراغه", "مرند", "اهر", "میانه", "بناب", "سراب", "آذرشهر", "هادیشهر", "عجب‌شیر", "ملکان", "شبستر", "بستان‌آباد", "هشترود", "اسکو", "کلیبر", "ورزقان", "جلفا", "خداآفرین", "سهند"],
            "آذربایجان غربی": ["ارومیه", "خوی", "بوکان", "مهاباد", "میاندوآب", "سلماس", "پیرانشهر", "نقده", "سردشت", "ماکو", "شاهین‌دژ", "تکاب", "اشنویه", "قره‌ضیاءالدین", "شوط", "سیه‌چشمه", "پلدشت"],
            "اردبیل": ["اردبیل", "پارس‌آباد", "مشگین‌شهر", "خلخال", "گرمی", "بیله‌سوار", "نمین", "جعفرآباد", "گیوی", "اصلاندوز", "نیر", "سرعین"],
            "اصفهان": ["اصفهان", "کاشان", "خمینی‌شهر", "نجف‌آباد", "شاهین‌شهر", "شهرضا", "فولادشهر", "مبارکه", "آران و بیدگل", "زرین‌شهر", "گلپایگان", "درچه", "فلاورجان", "لنجان", "نائین", "سمیرم", "خوانسار", "گزبرخوار", "تیران", "فریدون‌شهر"],
            "البرز": ["کرج", "فردیس", "کمال‌شهر", "نظرآباد", "محمدشهر", "ماهدشت", "مشکین‌دشت", "هشتگرد", "چهارباغ", "اشتهارد", "طالقان"],
            "ایلام": ["ایلام", "دهلران", "ایوان", "آبدانان", "دره‌شهر", "مهران", "سرابله", "ارکواز", "بدره", "چوار"],
            "بوشهر": ["بوشهر", "برازجان", "گناوه", "خورموج", "جم", "کنگان", "عسلویه", "دیر", "دیلم", "اهرم"],
            "تهران": ["تهران", "اسلام‌شهر", "شهریار", "قدس", "ملارد", "صالحیه", "پاکدشت", "قرچک", "ورامین", "نسیم‌شهر", "رباط‌کریم", "باغستان", "پردیس", "بومهن", "پیشوا", "دماوند", "فیروزکوه"],
            "چهارمحال و بختیاری": ["شهرکرد", "بروجن", "فرخ‌شهر", "فارسان", "لردگان", "هفشجان", "جونقان", "سامان", "فرادنبه", "بن", "اردل", "کیان", "سورشجان", "کوهرنگ"],
            "خراسان جنوبی": ["بیرجند", "قائن", "فردوس", "نهبندان", "طبس", "سربیشه", "سرایان", "بشروویه", "خوسف", "درمیان"],
            "خراسان رضوی": ["مشهد", "سبزوار", "نیشابور", "تربت حیدریه", "قوچان", "تربت جام", "کاشمر", "چناران", "سرخس", "گناباد", "فریمان", "درگز", "خواف", "تایباد", "بردسکن", "طرقبه", "شاندیز"],
            "خراسان شمالی": ["بجنورد", "شیروان", "اسفراین", "آشخانه", "جاجرم", "فاروج", "گرمه", "راز"],
            "خوزستان": ["اهواز", "دزفول", "آبادان", "بندر ماهشهر", "اندیمشک", "خرمشهر", "بهبهان", "ایذه", "شوشتر", "مسجدسلیمان", "بندر امام خمینی", "رامهرمز", "شادگان", "شوش", "سوسنگرد", "هویزه", "گتوند"],
            "زنجان": ["زنجان", "ابهر", "خرمدره", "قیدار", "هیدج", "صائین‌قلعه", "آب‌بر", "سلطانیه", "ماه‌نشان", "ایجرود"],
            "سمنان": ["سمنان", "شاهرود", "دامغان", "گرمسار", "مهدی‌شهر", "ایوانکی", "شهمیرزاد", "بسطام"],
            "سیستان و بلوچستان": ["زاهدان", "زابل", "ایرانشهر", "چابهار", "سراوان", "خاش", "کنارک", "جالق", "نیک‌شهر", "پیشین", "میرجاوه", "قصرقند", "راسک"],
            "فارس": ["شیراز", "کازرون", "جهرم", "مرودشت", "فسا", "داراب", "فیروزآباد", "نورآباد", "آباده", "لار", "اقلید", "نی‌ریز", "استهبان", "گراش", "زرقان", "لامرد", "صفاشهر"],
            "قزوین": ["قزوین", "تاکستان", "الوند", "آبیک", "اقبالیه", "محمدیه", "بیدستان", "بوئین‌زهرا", "شال"],
            "قم": ["قم", "جعفریه", "کهک", "قنوات", "سلفچگان"],
            "کردستان": ["سنندج", "سقز", "مریوان", "بانه", "قروه", "کامیاران", "بیجار", "دیواندره", "دهگلان", "سروآباد"],
            "کرمان": ["کرمان", "سیرجان", "رفسنجان", "جیرفت", "بم", "زرند", "کهنوج", "شهر بابک", "بافت", "بردسیر", "انار", "ماهان", "راور"],
            "کرمانشاه": ["کرمانشاه", "اسلام‌آباد غرب", "جوانرود", "کنگاور", "سرپل ذهاب", "سنقر", "هرسین", "صحنه", "پاوه", "روانسر", "گیلانغرب", "قصر شیرین"],
            "کهگیلویه و بویراحمد": ["یاسوج", "دوگنبدان", "دهدشت", "لیکک", "چرام", "لنده", "باشت", "سی‌سخت"],
            "گلستان": ["گرگان", "گنبد کاووس", "بندر ترکمن", "علی‌آباد کتول", "آق‌قلا", "کردکوی", "بندر گز", "مینودشت", "گالیکش", "کلاله", "رامیان"],
            "گیلان": ["رشت", "بندر انزلی", "لاهیجان", "لنگرود", "آستارا", "تالش", "صومعه‌سرا", "آستانه اشرفیه", "رودسر", "فومن", "خمام", "سیاهکل", "رضوانشهر", "ماسال", "املش"],
            "لرستان": ["خرم‌آباد", "بروجرد", "دورود", "کوهدشت", "الیگودرز", "نورآباد", "ازنا", "الشتر", "پلدختر", "چقابل"],
            "مازندران": ["ساری", "بابل", "آمل", "قائم‌شهر", "بهشهر", "چالوس", "نکا", "بابلسر", "نوشهر", "تنکابن", "فریدون‌کنار", "رامسر", "جویبار", "محمودآباد", "امیرکلا", "نور"],
            "مرکزی": ["اراک", "ساوه", "خمین", "محلات", "دلیجان", "تفرش", "آشتیان", "شازند", "مأمونیه", "کمیجان", "خنداب"],
            "هرمزگان": ["بندرعباس", "میناب", "دهبارز", "بندر لنگه", "کیش", "قشم", "بستک", "حاجی‌آباد", "کنگ", "پارسیان", "بندر جاسک"],
            "همدان": ["همدان", "ملایر", "نهاوند", "اسدآباد", "تویسرکان", "بهار", "کبودرآهنگ", "رزن", "لالجین", "فامنین"],
            "یزد": ["یزد", "میبد", "اردکان", "بافق", "مهریز", "ابرکوه", "تفت", "هرات", "زارچ", "اشکذر"]
        };
        // --- END: Provinces and Cities Data ---

        // --- START: Global State & Variables ---
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        let currentUser = null;
        let currentCheckoutStep = 1;
        let receiptFile = null;
        // --- END: Global State & Variables ---

        // --- START: DOM Element caching ---
        const DOMElements = {
            body: document.body,
            overlay: document.getElementById('overlay'),
            toast: document.getElementById('toast'),
            hamburger: document.getElementById('hamburger'),
            mobileMenu: document.getElementById('mobileMenu'),

            menPerfumes: document.getElementById('menPerfumes'),
            womenPerfumes: document.getElementById('womenPerfumes'),
            unisexPerfumes: document.getElementById('unisexPerfumes'),

            cartIcon: document.getElementById('cartIcon'),
            cartModal: document.getElementById('cartModal'),
            closeCart: document.getElementById('closeCart'),
            cartItems: document.getElementById('cartItems'),
            cartTotal: document.getElementById('cartTotal'),
            cartCount: document.getElementById('cartCount'),
            mobileCartCount: document.getElementById('mobileCartCount'),
            
            wishlistIcon: document.getElementById('wishlistIcon'),
            wishlistModal: document.getElementById('wishlistModal'),
            closeWishlist: document.getElementById('closeWishlist'),
            wishlistItems: document.getElementById('wishlistItems'),
            wishlistCount: document.getElementById('wishlistCount'),
            mobileWishlistCount: document.getElementById('mobileWishlistCount'),

            productModal: document.getElementById('productModal'),
            closeProductModal: document.getElementById('closeProductModal'),
            productDetailContent: document.getElementById('productDetailContent'),

            searchIcon: document.getElementById('searchIcon'),
            searchHeader: document.getElementById('searchHeader'),
            closeSearch: document.getElementById('closeSearch'),
            searchInput: document.getElementById('searchInput'),
            searchResults: document.getElementById('searchResults'),
            
            // Authentication
            authModal: document.getElementById('authModal'),
            closeAuthModal: document.getElementById('closeAuthModal'),
            loginBtn: document.getElementById('loginBtn'),
            userDropdown: document.getElementById('userDropdown'),
            userAvatar: document.getElementById('userAvatar'),
            logoutLink: document.getElementById('logoutLink'),
            authTabs: document.querySelectorAll('.auth-tab'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            loginButton: document.getElementById('loginButton'),
            registerButton: document.getElementById('registerButton'),
            mobileLogout: document.getElementById('mobileLogout'),
            mobileLogin: document.getElementById('mobileLogin'),
            
            // Checkout
            checkoutModal: document.getElementById('checkoutModal'),
            closeCheckout: document.getElementById('closeCheckout'),
            checkoutButton: document.getElementById('checkoutButton'),
            checkoutFooter: document.getElementById('checkoutFooter'),
            checkoutBackButton: document.getElementById('checkoutBackButton'),
            checkoutNextButton: document.getElementById('checkoutNextButton'),
            formContainers: {
                shippingInfo: document.getElementById('shippingInfoForm'),
            },
            shippingForm: {
                fullName: document.getElementById('fullName'),
                phoneNumber: document.getElementById('phoneNumber'),
                province: document.getElementById('province'),
                provinceList: document.getElementById('provinceList'),
                city: document.getElementById('city'),
                cityList: document.getElementById('cityList'),
                address: document.getElementById('address'),
                postalCode: document.getElementById('postalCode'),
            },
        };
        // --- END: DOM Element caching ---

        // --- START: Utility Functions ---
        const formatPrice = (price) => `${parseInt(price).toLocaleString('fa-IR')} تومان`;
        
        const showToast = (message) => {
            DOMElements.toast.textContent = message;
            DOMElements.toast.classList.add('show');
            setTimeout(() => DOMElements.toast.classList.remove('show'), 3000);
        };
        
        const toggleOverlay = (isActive) => {
            DOMElements.overlay.classList.toggle('active', isActive);
            DOMElements.body.classList.toggle('modal-open', isActive);
        };

        const openModal = (modal) => {
            modal.classList.add('active');
            toggleOverlay(true);
        };

        const closeModal = (modal) => {
            modal.classList.remove('active');
            if (!document.querySelector('.modal.active, .side-modal.open')) {
                toggleOverlay(false);
            }
        };

        const openSideModal = (modal) => {
            modal.classList.add('open');
            toggleOverlay(true);
        };

        const closeSideModal = (modal) => {
            modal.classList.remove('open');
             if (!document.querySelector('.modal.active, .side-modal.open')) {
                toggleOverlay(false);
            }
        };
        // --- END: Utility Functions ---

        // --- START: Product & UI Rendering ---
        const generateProductCards = () => {
            const containers = {
                men: DOMElements.menPerfumes,
                women: DOMElements.womenPerfumes,
                unisex: DOMElements.unisexPerfumes
            };
            Object.values(containers).forEach(c => c.innerHTML = '');

            perfumes.forEach(perfume => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                const basePrice = perfume.sizes[0].price;
                const isInWishlist = wishlist.some(item => item.id === perfume.id);
                
                productCard.innerHTML = `
                    <div class="product-image">
                        <img src="${perfume.image}" alt="${perfume.name}" loading="lazy">
                        ${perfume.badge ? `<span class="product-badge">${perfume.badge}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${perfume.name}</h3>
                        <div class="product-bottom">
                            <div class="product-price">${formatPrice(basePrice)}</div>
                            <div class="product-actions">
                                <button class="action-btn wishlist-btn" data-id="${perfume.id}" aria-label="افزودن به علاقه‌مندی‌ها">
                                    <i class="${isInWishlist ? 'fas' : 'far'} fa-heart"></i>
                                </button>
                                <button class="action-btn add-to-cart-btn" aria-label="افزودن به سبد خرید">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>`;
                
                productCard.querySelector('.add-to-cart-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    addToCart(perfume, perfume.sizes[0].size, perfume.sizes[0].price);
                });
                
                productCard.querySelector('.wishlist-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleWishlist(perfume);
                });
                
                productCard.addEventListener('click', () => showProductDetails(perfume));
                
                const container = containers[perfume.category];
                if(container) container.appendChild(productCard);
            });
        };

        const showProductDetails = (perfume) => {
            const isInWishlist = wishlist.some(item => item.id === perfume.id);
            DOMElements.productDetailContent.innerHTML = `
                <div class="product-detail-image">
                    <img src="${perfume.image}" alt="${perfume.name}">
                </div>
                <div class="product-detail-info">
                    <h2 class="product-detail-title">${perfume.name}</h2>
                    <div class="product-detail-price">${formatPrice(perfume.sizes[0].price)}</div>
                    <p>${perfume.description}</p>
                    <div class="product-detail-actions">
                        <button class="add-to-cart-detail">
                            <i class="fas fa-shopping-cart"></i> افزودن به سبد خرید
                        </button>
                        <button class="wishlist-btn-detail">
                            <i class="${isInWishlist ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                    </div>
                </div>`;
            
            DOMElements.productDetailContent.querySelector('.add-to-cart-detail').addEventListener('click', () => {
                addToCart(perfume, perfume.sizes[0].size, perfume.sizes[0].price);
            });
            DOMElements.productDetailContent.querySelector('.wishlist-btn-detail').addEventListener('click', () => {
                toggleWishlist(perfume);
                // Re-render details to update icon
                showProductDetails(perfume);
            });

            openModal(DOMElements.productModal);
        };
        // --- END: Product & UI Rendering ---

        // --- START: Cart & Wishlist Logic ---
        const saveToLocalStorage = (key, data) => localStorage.setItem(key, JSON.stringify(data));
        
        const updateCounters = () => {
            const cartCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            DOMElements.cartCount.textContent = cartCount;
            DOMElements.mobileCartCount.textContent = cartCount;

            const wishlistCount = wishlist.length;
            DOMElements.wishlistCount.textContent = wishlistCount;
            DOMElements.mobileWishlistCount.textContent = wishlistCount;
        };

        const addToCart = (perfume, size, price) => {
            const existingItem = cart.find(item => item.id === perfume.id && item.size === size);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ id: perfume.id, name: perfume.name, size, price, image: perfume.image, quantity: 1 });
            }
            saveToLocalStorage('cart', cart);
            updateCounters();
            updateCartUI();
            showToast(`${perfume.name} به سبد خرید اضافه شد!`);
        };
        
        const toggleWishlist = (perfume) => {
            const index = wishlist.findIndex(item => item.id === perfume.id);
            if (index === -1) {
                wishlist.push({ id: perfume.id, name: perfume.name, price: perfume.price, image: perfume.image });
                showToast('به لیست علاقه‌مندی‌ها اضافه شد');
            } else {
                wishlist.splice(index, 1);
                showToast('از لیست علاقه‌مندی‌ها حذف شد');
            }
            saveToLocalStorage('wishlist', wishlist);
            updateCounters();
            generateProductCards(); // Re-render to update heart icons
        };

        const updateCartUI = () => {
            if (cart.length === 0) {
                DOMElements.cartItems.innerHTML = '<div style="text-align: center; padding: 30px; color: #777;">سبد خرید شما خالی است</div>';
                DOMElements.cartTotal.textContent = formatPrice(0);
                DOMElements.checkoutButton.disabled = true;
                return;
            }

            DOMElements.checkoutButton.disabled = false;
            let total = 0;
            DOMElements.cartItems.innerHTML = cart.map((item, index) => {
                total += item.price * item.quantity;
                return `
                    <div class="cart-item">
                        <div class="cart-item-image"><img src="${item.image}" alt="${item.name}"></div>
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name} (${item.size})</div>
                            <div class="cart-item-price">${item.quantity} × ${formatPrice(item.price)}</div>
                        </div>
                        <button class="cart-item-remove" data-index="${index}" aria-label="حذف محصول"><i class="fas fa-trash"></i></button>
                    </div>`;
            }).join('');
            
            DOMElements.cartTotal.textContent = formatPrice(total);
            DOMElements.cartItems.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.addEventListener('click', () => {
                    cart.splice(btn.dataset.index, 1);
                    saveToLocalStorage('cart', cart);
                    updateCounters();
                    updateCartUI();
                });
            });
        };

        const updateWishlistUI = () => {
            if (wishlist.length === 0) {
                DOMElements.wishlistItems.innerHTML = '<div style="text-align: center; padding: 30px; color: #777;">لیست شما خالی است.</div>';
                return;
            }
            DOMElements.wishlistItems.innerHTML = wishlist.map((item, index) => `
                <div class="cart-item">
                     <div class="cart-item-image"><img src="${item.image}" alt="${item.name}"></div>
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${formatPrice(item.price)}</div>
                    </div>
                    <button class="cart-item-remove" data-index="${index}" aria-label="حذف"><i class="fas fa-trash"></i></button>
                </div>
            `).join('');

            DOMElements.wishlistItems.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.addEventListener('click', () => {
                    toggleWishlist(wishlist[btn.dataset.index]);
                    updateWishlistUI();
                });
            });
        };
        // --- END: Cart & Wishlist Logic ---

        // --- START: Authentication ---
        const handleAuthStateChanged = (user) => {
            currentUser = user;
            const isLoggedIn = !!user;
            DOMElements.loginBtn.style.display = isLoggedIn ? 'none' : 'block';
            DOMElements.userDropdown.style.display = isLoggedIn ? 'block' : 'none';
            DOMElements.mobileLogin.style.display = isLoggedIn ? 'none' : 'flex';
            DOMElements.mobileLogout.style.display = isLoggedIn ? 'flex' : 'none';
            if (isLoggedIn) {
                DOMElements.userAvatar.src = user.photoURL || `https://ui-avatars.com/api/?name=${user.displayName || user.email}`;
                closeModal(DOMElements.authModal);
            }
        };

        const signOut = () => auth.signOut().then(() => showToast('با موفقیت خارج شدید'));
        // --- END: Authentication ---
        
        // --- START: Setup & Initialization ---
        const setupEventListeners = () => {
            // Overlay
            DOMElements.overlay.addEventListener('click', () => {
                document.querySelectorAll('.modal.active, .side-modal.open').forEach(m => {
                    closeModal(m); closeSideModal(m);
                });
                DOMElements.mobileMenu.classList.remove('active');
                DOMElements.hamburger.classList.remove('active');
                toggleOverlay(false);
            });
            
            // Hamburger
            DOMElements.hamburger.addEventListener('click', () => {
                const isActive = DOMElements.mobileMenu.classList.toggle('active');
                DOMElements.hamburger.classList.toggle('active', isActive);
                toggleOverlay(isActive);
            });
            document.querySelectorAll('.close-mobile-menu').forEach(link => {
                link.addEventListener('click', () => {
                    DOMElements.mobileMenu.classList.remove('active');
                    DOMElements.hamburger.classList.remove('active');
                    toggleOverlay(false);
                });
            });
            
            // Modals
            DOMElements.cartIcon.addEventListener('click', () => { updateCartUI(); openSideModal(DOMElements.cartModal); });
            DOMElements.wishlistIcon.addEventListener('click', () => { updateWishlistUI(); openSideModal(DOMElements.wishlistModal); });
            DOMElements.closeCart.addEventListener('click', () => closeSideModal(DOMElements.cartModal));
            DOMElements.closeWishlist.addEventListener('click', () => closeSideModal(DOMElements.wishlistModal));
            DOMElements.closeProductModal.addEventListener('click', () => closeModal(DOMElements.productModal));
            DOMElements.closeAuthModal.addEventListener('click', () => closeModal(DOMElements.authModal));

            // Auth
            DOMElements.loginBtn.addEventListener('click', () => openModal(DOMElements.authModal));
            DOMElements.mobileLogin.addEventListener('click', () => {
                DOMElements.mobileMenu.classList.remove('active');
                toggleOverlay(false);
                openModal(DOMElements.authModal);
            });
            DOMElements.logoutLink.addEventListener('click', signOut);
            DOMElements.mobileLogout.addEventListener('click', signOut);
            DOMElements.authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    DOMElements.authTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    DOMElements.loginForm.classList.toggle('active', tab.dataset.tab === 'login');
                    DOMElements.registerForm.classList.toggle('active', tab.dataset.tab === 'register');
                });
            });

            // Search
            DOMElements.searchIcon.addEventListener('click', () => { DOMElements.searchHeader.classList.add('active'); DOMElements.searchInput.focus(); });
            DOMElements.closeSearch.addEventListener('click', () => DOMElements.searchHeader.classList.remove('active'));

            // Checkout
            DOMElements.checkoutButton.addEventListener('click', () => {
                if (!currentUser) {
                    showToast('برای ادامه، لطفا وارد شوید.');
                    openModal(DOMElements.authModal);
                    return;
                }
                openSideModal(DOMElements.checkoutModal);
            });
            DOMElements.closeCheckout.addEventListener('click', () => closeSideModal(DOMElements.checkoutModal));
        };

        const init = () => {
            generateProductCards();
            updateCounters();
            setupEventListeners();
            auth.onAuthStateChanged(handleAuthStateChanged);
        };

        document.addEventListener('DOMContentLoaded', init);
        // --- END: Setup & Initialization ---
    </script>
</body>
</html>
